{"version":3,"file":"mpstore.es6m.js","sources":["../src/utils.js","../src/mixin.js","../src/module.js","../src/diff.js","../src/update.js","../src/time-travel.js","../src/middleware.js","../src/store.js","../src/index.js"],"sourcesContent":["export function warning (message, noError) {\r\n  message = `\\n\\n[MpStore warning]: ${message}\\n\\n`\r\n  if (noError) {\r\n    console.warn(message)\r\n    return\r\n  }\r\n  throw new Error(message)\r\n}\r\n\r\nexport function assert (condition, message) {\r\n  if (!condition) warning(message)\r\n}\r\n\r\nexport function isPrimitive (value) {\r\n  return (\r\n    typeof value === 'string' ||\r\n    typeof value === 'number' ||\r\n    typeof value === 'symbol' ||\r\n    typeof value === 'boolean'\r\n  )\r\n}\r\n\r\nexport function deepFreeze (state) {\r\n  const names = Object.getOwnPropertyNames(state)\r\n  let len = names.length\r\n  while (~len--) {\r\n    const value = state[names[len]]\r\n    if (typeof value === 'object' && value !== null) {\r\n      deepFreeze(value)\r\n    }\r\n  }\r\n  return Object.freeze(state)\r\n}\r\n\r\nexport function mergeState (oldState, newState) {\r\n  return deepFreeze(Object.assign({}, oldState, newState))\r\n}\r\n\r\nexport function mixinMethods (config, methods) {\r\n  for (const key in methods) {\r\n    if (!(key in config)) {\r\n      config[key] = methods[key]\r\n    }\r\n  }\r\n}\r\n\r\nexport function inspectState(partialState, state, sendWarn) {\r\n  for (const key in partialState) {\r\n    assert(!state.hasOwnProperty(key), sendWarn(key))\r\n  }\r\n}\r\n\r\n// remove component from depsComponent\r\nexport function remove (list, component) {\r\n  const index = list.findIndex(item => item.component === component)\r\n  if (index > -1) {\r\n    list.splice(index, 1)\r\n  }\r\n}\r\n\r\nexport function callHook (hooks, name, args) {\r\n  if (hooks && typeof hooks[name] === 'function') {\r\n    return hooks[name].apply(hooks, args)\r\n  }\r\n}\r\n\r\nexport function isEmptyObject (obj) {\r\n  for (const k in obj){\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function mapObject (obj, fn) {\r\n  const destObject = {}\r\n  for (const key in obj) {\r\n    if (obj.hasOwnProperty(key)) {\r\n      destObject[key] = fn(obj[key])\r\n    }\r\n  }\r\n  return destObject\r\n}\r\n\r\nexport function createWraper (target, before, after) {\r\n  return function (...args) {\r\n    let result\r\n\r\n    if (typeof before === 'function') {\r\n      before.apply(this, args)\r\n    }\r\n\r\n    if (typeof target === 'function') {\r\n      result = target.apply(this, args)\r\n    }\r\n\r\n    if (typeof after === 'function') {\r\n      after.apply(this, args)\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\nexport function isPlainObject (obj) {\r\n  if (typeof obj !== 'object' || obj === null) return false\r\n\r\n  const proto = Object.getPrototypeOf(obj)\r\n  if (proto === null) return true\r\n\r\n  let baseProto = proto\r\n  while (Object.getPrototypeOf(baseProto) !== null) {\r\n    baseProto = Object.getPrototypeOf(baseProto)\r\n  }\r\n  return proto === baseProto\r\n}\r\n\r\nexport function clone (value, record = new WeakMap) {\r\n  if (\r\n    value === null ||\r\n    value === undefined ||\r\n    isPrimitive(value) ||\r\n    typeof value === 'function' ||\r\n    value instanceof Date\r\n  ) {\r\n    return value\r\n  }\r\n\r\n  if (record.has(value)) return record.get(value)\r\n\r\n  const result = typeof value.constructor !== 'function'\r\n    ? Object.create(null) \r\n    : new value.constructor()\r\n\r\n  record.set(value, result)\r\n\r\n  for (const key in value) {\r\n    result[key] = clone(value[key], record)\r\n  }\r\n\r\n  return result\r\n}\r\n\r\n// parse simple path\r\nexport function parsePath (path) {\r\n  const segments = path.split('.')\r\n  return function (obj) {\r\n    for (let i = 0, len = segments.length; i < len; i++) {\r\n      if (!obj) return\r\n      obj = obj[segments[i]]\r\n    }\r\n    return obj\r\n  }\r\n}","import { assert } from './utils'\r\n\r\nexport default function (inject) {\r\n  const expandMethods = Object.create(null)\r\n\r\n  if (typeof inject === 'function') {\r\n    const callback = (name, fn) => {\r\n      assert(\r\n        typeof name === 'string',\r\n        `The mixed method name must a string.`,\r\n      )\r\n\r\n      assert(\r\n        typeof fn === 'function',\r\n        'The mixed method is not a function.'\r\n      )\r\n\r\n      assert(\r\n        !(name in expandMethods),\r\n        `The \"${name}\" is exist,`, +\r\n          `Please don't repeat mixin.`\r\n      )\r\n\r\n      expandMethods[name] = fn\r\n    }\r\n\r\n    inject(callback)\r\n  }\r\n  return expandMethods\r\n}","import { assert, parsePath, isPlainObject } from './utils'\r\n\r\n// 1. can't delete module, if module is created\r\n// 2. modules allow nesting\r\n\r\nexport const MODULE_FLAG = '__mpModule'\r\n\r\nexport function isModule (m) {\r\n  return isPlainObject(m) && m[MODULE_FLAG] === true\r\n}\r\n\r\nexport function getModule (state, namespace) {\r\n  return namespace\r\n    ? parsePath(namespace)(state)\r\n    : state\r\n}\r\n\r\nexport function mergeModule (module, partialModule, createMsg) {\r\n  const keys = Object.keys(partialModule)\r\n  let len = keys.length\r\n\r\n  while(~--len) {\r\n    const key = keys[len]\r\n\r\n    // inspect all attribute\r\n    if (createMsg) {\r\n      assert(!(key in module), createMsg)\r\n    } else {\r\n      assert(\r\n        !(isModule(module[key]) && !isModule(partialModule[key])),\r\n        `The [${key}] is a module that you can change to other values.`,\r\n      )\r\n    }\r\n  }\r\n  return Object.assign({}, module, partialModule)\r\n}\r\n\r\nexport function createModule (obj) {\r\n  assert(\r\n    isPlainObject(obj),\r\n    'The base module object must be an plain object',\r\n  )\r\n\r\n  if (isModule(obj)) return obj\r\n\r\n  assert(\r\n    !(MODULE_FLAG in obj),\r\n    `the [${MODULE_FLAG}] is the keyword of the mpStore module, you can't use it`,\r\n  )\r\n\r\n  obj[MODULE_FLAG] = true\r\n  return obj\r\n}\r\n\r\n// 1. if want to define a module, the parent and child modules must be modules.\r\n// demo:\r\n//   store.add('action', {\r\n//     __mpModule: true,\r\n//      childModule: {\r\n//       __mpModule: true,\r\n//     }\r\n//   })\r\n// \r\n// 2. if create new module, we need jugement the namespace whether in parent module\r\nexport function createModuleByNamespace (namespace, partialModule, rootModule, action) {\r\n  if (!namespace) {\r\n    return mergeModule(rootModule, partialModule)\r\n  }\r\n\r\n  let parentWraper = {}\r\n  let parentModule = rootModule\r\n  const moduleWraper = parentWraper\r\n  const segments = namespace.split('.')\r\n  const remaingMsg =  action ? `\\n\\n  --- from [${action}] action` : ''\r\n\r\n  for (let i = 0, len = segments.length; i < len; i++) {\r\n    const key = segments[i]\r\n\r\n    // the global state certainly module\r\n    if (i > 0) {\r\n      assert(\r\n        isModule(parentModule),\r\n        'the child modules must be in the parent module.\\n\\n' +\r\n          ` parent module namespace is [${key}]\\n\\n` +\r\n            ` child module namespace is [${segments[i - 1]}]${remaingMsg}`, \r\n      )\r\n    }\r\n\r\n    if (key in parentModule) {\r\n      assert(\r\n        isModule(parentModule[key]),\r\n        'you can\\'t create child moudle, ' +\r\n          `because the [${key}] already exists in [${segments[i - 1] || 'root'}] module, ` +\r\n            `but [${key}] not a module.${remaingMsg}`,\r\n      )\r\n\r\n      // the parentModule is module\r\n      const childModule = i === len - 1\r\n        ? mergeModule(parentModule[key], partialModule)\r\n        : parentModule[key]\r\n      \r\n      parentWraper[key] = childModule\r\n      parentWraper = childModule\r\n    } else {\r\n      const childModule = i === len - 1\r\n        ? createModule(partialModule)\r\n        : { __mpModule: true }\r\n\r\n      parentWraper[key] = childModule\r\n      parentWraper = childModule\r\n    }\r\n\r\n    parentModule = parentModule[key]\r\n  }\r\n  return moduleWraper\r\n}\r\n\r\n\r\n// const state = {\r\n//   a: 1,\r\n//   b: createModule({\r\n//     ba: 1,\r\n//     c: createModule({\r\n//       name: 'tao'\r\n//     }),\r\n//     d: createModule({\r\n//       dm: createModule({\r\n//         ab: 'code',\r\n//         arr: [121],\r\n//         child: {\r\n//           name: 'chen',\r\n//           __mpModule: true,\r\n//         }\r\n//       })\r\n//     })\r\n//   })\r\n// }\r\n\r\n// const namespace = ''\r\n// const module = getModule(state, namespace)\r\n// const newPModule = createModuleByNamespace(namespace, {\r\n//   aaa: 121,\r\n//   dm: {\r\n//     __mpModule: true\r\n//   }\r\n// }, state, 'test')\r\n// console.log(module)\r\n// console.log(newPModule)","export const ADD = 1\r\nexport const REMOVE = 2\r\nexport const REPLACE = 3\r\n\r\nfunction Patch (type, path, value, leftValue) {\r\n  this.type = type\r\n  this.path = path\r\n  this.value = value\r\n  this.leftValue = leftValue\r\n}\r\n\r\n// compare left and right values\r\nfunction diffValues (left, right, path, patchs) {\r\n  // filter functin and null\r\n  if (typeof left === 'function' || left === null) {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  } else if (Array.isArray(left)) {\r\n    // diff array\r\n    if (Array.isArray(right)) {\r\n      walkArray(left, right, path, patchs)\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else if (typeof left === 'object') {\r\n    // diff object\r\n    if (\r\n        right !== null &&\r\n        typeof right === 'object' &&\r\n        !Array.isArray(right)\r\n    ) {\r\n      // filter Date object\r\n      if (left instanceof Date || right instanceof Date) {\r\n        patchs.push(new Patch(REPLACE, path, right, left))\r\n      } else {\r\n        walkObject(left, right, path, patchs)\r\n      }\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  }\r\n}\r\n\r\n// if array is `[1, 2, 3, a: dd]`, filter `a`\r\nfunction walkArray (a, b, base, patchs) {\r\n  if (a.length <= b.length) {\r\n    let len = a.length\r\n    while (~--len) {\r\n      if (a[len] !== b[len]) {\r\n        const path = `${base}[${len}]`\r\n        diffValues(a[len], b[len], path, patchs)\r\n      }\r\n    }\r\n  \r\n    if (b.length > a.length) {\r\n      len = b.length\r\n      while (--len >= a.length) {\r\n        const path = `${base}[${len}]`\r\n        patchs.push(new Patch(ADD, path, b[len], a[len]))\r\n      }\r\n    }\r\n  } else {\r\n    // if new list less than old list,\r\n    // no need diff, direct replace is fine.\r\n    patchs.push(new Patch(REPLACE, base, b, a))\r\n  }\r\n}\r\n\r\nfunction walkObject (a, b, base, patchs) {\r\n  // walk left object\r\n  for (const key in a) {\r\n    // current path\r\n    const path = `${base}.${key}`\r\n\r\n    if (!(key in b)) {\r\n      patchs.push(new Patch(REMOVE, path, null, a[key]))\r\n    } else if (a[key] !== b[key]) {\r\n      diffValues(a[key], b[key], path, patchs)\r\n\r\n      // don't use `delete` statement,\r\n      // will destroy the stability of the `object` structure\r\n      // delete b[key]\r\n    }\r\n  }\r\n\r\n  // walk right object\r\n  for (const key in b) {\r\n    if (!(key in a)) {\r\n      const path = `${base}.${key}`\r\n      patchs.push(new Patch(ADD, path, b[key], null))\r\n    }\r\n  }\r\n}\r\n\r\n// root `a` and root `b` is an object\r\nexport function diff (a, b, basePath) {\r\n  const patchs = []\r\n  walkObject(a, b, basePath, patchs)\r\n  return patchs\r\n}\r\n\r\nconst REG = /[^\\[\\].]+(?=[\\[\\].])/g\r\n\r\n// return target object\r\nfunction separatePath (obj, path) {\r\n  const keys = path.match(REG)\r\n\r\n  // delete first key\r\n  if (keys && keys.shift() && keys.length > 0) {\r\n    let i = -1\r\n    let key = null\r\n    let target = obj\r\n    let prevTarget = null\r\n\r\n    while (i++ < keys.length - 2) {\r\n      prevTarget = target\r\n      key = keys[i]\r\n      target = target[key]\r\n    }\r\n\r\n    return [target, key, prevTarget, keys[keys.length -1]]\r\n  }\r\n}\r\n\r\nexport function restore (obj, patchs) {\r\n  let len = patchs.length\r\n  const deleteEmptys = new Map()\r\n\r\n  while (~--len) {\r\n    const { type, path, leftValue } = patchs[len]\r\n    // use es5 reg\r\n    const parseItem = separatePath(obj, path + '.')\r\n\r\n    if (parseItem) {\r\n      const [target, key, prevTarget, lastKey] = parseItem\r\n\r\n      // reverse recovery\r\n      switch (type) {\r\n        case REMOVE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case REPLACE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case ADD :\r\n          if (Array.isArray(target) && target === prevTarget[key]) {\r\n            deleteEmptys.set(target, { key, prevTarget })\r\n          }\r\n          delete target[lastKey]\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  deleteEmptys.forEach(({ key, prevTarget }, target) => {\r\n    const clone = new target.constructor()\r\n    // filter empty item\r\n    target.forEach(item => clone.push(item))\r\n    prevTarget[key] = clone\r\n  })\r\n\r\n  return obj\r\n}","import { diff } from './diff'\r\nimport { callHook } from './utils'\r\n\r\nexport function applyPatchs (component, patchs, callback) {\r\n  const destObject = {}\r\n\r\n  for (let i = 0, len = patchs.length; i < len; i++) {\r\n    const { value, path } = patchs[i]\r\n    destObject[path] = value\r\n  }\r\n\r\n  component.setData(destObject, callback)\r\n}\r\n\r\n// update page and component\r\nexport function updateComponents (store, callback) {\r\n  let total = 0\r\n  const {\r\n    hooks,\r\n    GLOBALWORD,\r\n    depComponents,\r\n  } = store\r\n  const len = depComponents.length\r\n\r\n  if (len === 0) {\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n    return\r\n  }\r\n\r\n  // call `callback`, when all component views are rendered\r\n  const renderedCallback = () => {\r\n    if (++total === len) {\r\n      if (typeof callback === 'function') {\r\n        callback()\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    const {\r\n      isPage,\r\n      component,\r\n      didUpdate,\r\n      willUpdate,\r\n      createState,\r\n    } = depComponents[i]\r\n\r\n    if (component.data[GLOBALWORD]) {\r\n      const newPartialState = createState()\r\n\r\n      // the `willUpdate` function will optimize component\r\n      if (typeof willUpdate === 'function') {\r\n        if (willUpdate.call(store, component, newPartialState) === false) {\r\n          renderedCallback()\r\n          continue\r\n        }\r\n      }\r\n\r\n      // the base path is `GLOBALWORD`\r\n      // example: this.setData({ 'global.xx': xx })\r\n      const patchs = diff(component.data[GLOBALWORD], newPartialState, GLOBALWORD)\r\n\r\n      if (patchs.length > 0) {\r\n        // call global hooks\r\n        const params = [component, newPartialState, patchs, isPage]\r\n        if (callHook(hooks, 'willUpdate', params) === false) {\r\n          renderedCallback()\r\n          continue\r\n        }\r\n\r\n        // update component\r\n        applyPatchs(component, patchs, renderedCallback)\r\n\r\n        if (typeof didUpdate === 'function') {\r\n          didUpdate.call(store, component, newPartialState, patchs)\r\n        }\r\n        \r\n        callHook(hooks, 'didUpdate', [component, newPartialState, isPage])\r\n\r\n        // record patchs, allow playback view\r\n        if (component.timeTravel) {\r\n          component.timeTravel.push(patchs)\r\n        }\r\n      } else {\r\n        renderedCallback()\r\n      }\r\n    } else {\r\n      renderedCallback()\r\n    }\r\n  }\r\n}","import { applyPatchs } from './update'\r\nimport { diff, restore } from './diff'\r\nimport { warning, clone, assert } from './utils'\r\n\r\nexport default class TimeTravel {\r\n  constructor (component, GLOBALWORD, limit) {\r\n    this.history = []\r\n    this.limit = limit\r\n    this.component = component\r\n    this.GLOBALWORD = GLOBALWORD\r\n    this.length = this.history.length\r\n    this.current = this.history.length\r\n    this.finallyState = component.data[GLOBALWORD]\r\n  }\r\n\r\n  // only record diff patchs\r\n  // so, can't restore to the state at initialization\r\n  push (patchs) {\r\n    const {\r\n      limit,\r\n      history,\r\n      GLOBALWORD,\r\n      history: { length },\r\n      component: { data },\r\n    } = this\r\n\r\n    if (limit > 0) {\r\n      // if exceed the limit, should to remove the extra item\r\n      const extraCount = length - limit\r\n      if (extraCount >= 0) {\r\n        this.history.splice(0, extraCount + 1)\r\n      }\r\n\r\n      this.history.push(patchs)\r\n      this.length = history.length\r\n      this.current = history.length\r\n      // need deep clone state\r\n      this.finallyState = clone(data[GLOBALWORD])\r\n    }\r\n  }\r\n\r\n  go (n) {\r\n    const {\r\n      current,\r\n      history,\r\n      component,\r\n      GLOBALWORD,\r\n      finallyState,\r\n    } = this\r\n\r\n    assert(\r\n      GLOBALWORD in component.data,\r\n      'You can\\'t use [timeTravel] because it only works for [global state]',\r\n    )\r\n\r\n    if (this.limit > 0) {\r\n      if (n !== 0) {\r\n        const range = n + current\r\n        const backtrack = Math.abs(n)\r\n\r\n        if (range < 0 || range > history.length) {\r\n          warning(`Index [${range}] is not within the allowed range.`, true)\r\n          return\r\n        }\r\n\r\n        let index = 0\r\n        // deep clone patchs and state, we need keep state is immutable\r\n        let data = clone(component.data[GLOBALWORD])\r\n\r\n        while(index++ < backtrack) {\r\n          const id = current + Math.sign(n) * index\r\n          if (id < history.length) {\r\n            const patchs = clone(history[id])\r\n            data = restore(data, patchs)\r\n          } else {\r\n            data = finallyState\r\n          }\r\n        }\r\n\r\n        const endPatchs = diff(component.data[GLOBALWORD], data, GLOBALWORD)\r\n        if (endPatchs.length > 0) {\r\n          applyPatchs(component, endPatchs)\r\n        }\r\n\r\n        this.current += n\r\n      }\r\n    }\r\n  }\r\n\r\n  forward () {\r\n    this.go(1)\r\n  }\r\n\r\n  back () {\r\n    this.go(-1)\r\n  }\r\n\r\n  toStart () {\r\n    this.go(-this.current)\r\n  }\r\n\r\n  toEnd () {\r\n    this.go(this.history.length - this.current)\r\n  }\r\n}","import { warning, assert } from './utils'\r\n\r\nexport const COMMONACTION = () => {}\r\n\r\nfunction match (layer, action) {\r\n  if (layer.action === COMMONACTION) return true\r\n  return action === layer.action\r\n}\r\n\r\nfunction handleLayer (\r\n  action,\r\n  fn,\r\n  store,\r\n  payload,\r\n  next,\r\n  restoreProcessState,\r\n) {\r\n  try {\r\n    fn.call(store, payload, next, action)\r\n    restoreProcessState()\r\n  } catch (error) {\r\n    const hooks = store.hooks\r\n    restoreProcessState()\r\n\r\n    // if the error hook exist, don't throw error\r\n    if (hooks && typeof hooks['middlewareError'] === 'function') {\r\n      hooks['middlewareError'](action, payload, error)\r\n    } else {\r\n      warning(`${error}\\n\\n   --- from middleware [${action}] action.`)\r\n    }\r\n  }\r\n}\r\n\r\n// deal with all middleware\r\nexport class Middleware {\r\n  constructor (store) {\r\n    this.stack = []\r\n    this.store = store\r\n    this.isProcessing = false\r\n  }\r\n\r\n  use (action, fn) {\r\n    assert(\r\n      !this.isProcessing,\r\n      'can\\'t allow add new middleware in the middleware processing.'\r\n    )\r\n    this.stack.push({ fn, action })\r\n  }\r\n\r\n  remove (action, fn) {\r\n    const index = this.stack.findIndex(layer => {\r\n      return layer.fn === fn && layer.action === action\r\n    })\r\n\r\n    if (index > -1) {\r\n      this.stack.splice(index, 1)\r\n    }\r\n  }\r\n\r\n  process (action, payload, finish) {\r\n    // can't allow add new middleware in the middleware processing and setter function\r\n    this.isProcessing = true\r\n    const restoreProcessState = () => {\r\n      this.isProcessing = false\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      let index = 0\r\n      const next = prevPayload => {\r\n        let layer = this.stack[index]\r\n\r\n        index++\r\n\r\n        while (layer && !match(layer, action)) {\r\n          layer = this.stack[index++]\r\n        }\r\n\r\n        if (layer) {\r\n          // put `try catch` in a separate function,\r\n          // avoid the entire function not being optimized.\r\n          handleLayer(\r\n            action,\r\n            layer.fn,\r\n            this.store,\r\n            prevPayload,\r\n            next,\r\n            restoreProcessState,\r\n          )\r\n        } else {\r\n          finish(prevPayload, restoreProcessState)\r\n        }\r\n      }\r\n\r\n      next(payload)\r\n    } else {\r\n      finish(payload, restoreProcessState)\r\n    }\r\n  }\r\n}","import {\r\n  clone,\r\n  assert,\r\n  remove,\r\n  warning,\r\n  callHook,\r\n  parsePath,\r\n  mapObject,\r\n  mergeState,\r\n  createWraper,\r\n  inspectState,\r\n  isPlainObject,\r\n  isEmptyObject,\r\n} from './utils'\r\n\r\nimport {\r\n  isModule,\r\n  getModule,\r\n  MODULE_FLAG,\r\n  createModule,\r\n  createModuleByNamespace,\r\n} from './module'\r\n\r\nimport { diff } from './diff'\r\nimport TimeTravel from './time-travel'\r\nimport { Middleware, COMMONACTION } from './middleware'\r\nimport { applyPatchs, updateComponents } from './update'\r\n\r\n// Each `store` instance has a unique id\r\nlet storeId = 0\r\n\r\nfunction filterReducer (state, action, reducer) {\r\n  const { setter, namespace, partialState } = reducer\r\n\r\n  assert(\r\n    'partialState' in reducer,\r\n    `You must defined [partialState].` + \r\n      `\\n\\n --- from [${action}] action.`,\r\n  )\r\n\r\n  assert(\r\n    isPlainObject(partialState),\r\n    `The [partialState] must be an object.` +\r\n      `\\n\\n --- from [${action}] action.`,\r\n  )\r\n\r\n  if ('namespace' in reducer) {\r\n    assert(\r\n      typeof namespace === 'string',\r\n      'The module namespace must be a string.' +\r\n        `\\n\\n --- from [${action}] action.`,\r\n    )\r\n\r\n    const module = getModule(state, namespace, action)\r\n    \r\n    if (module) {\r\n      // const newPartialModule = mergeModule(module, partialState, true)\r\n      // const \r\n    } else {\r\n\r\n    }\r\n  } else {\r\n    // inspect all state key \r\n    inspectState(partialState, state, key => {\r\n      return `The [${key}] already exists in global state, ` +\r\n        `Please don't repeat defined. \\n\\n --- from [${action}] action.`\r\n    })\r\n\r\n    // if `partialState` have `__mpModule` word, in fact, the `partialState` is module\r\n    if (isModule(partialState)) {\r\n\r\n    }\r\n  }\r\n\r\n  if (typeof setter !== 'function') {\r\n    reducer.setter = () => {\r\n      warning(\r\n        `Can\\'t changed [${action}] action value. Have you defined a setter?` +\r\n          `\\n\\n --- from [${action}] action.`\r\n      )\r\n    }\r\n  }\r\n  return reducer\r\n}\r\n\r\nexport class Store {\r\n  constructor (hooks) {\r\n    this.hooks = hooks\r\n    this.reducers = []\r\n    this.id = ++storeId\r\n    this.depComponents = []\r\n    this.GLOBALWORD = 'global' // global state namespace\r\n    this.isDispatching = false\r\n    this.version = __VERSION__\r\n    this.state = Object.freeze(createModule({}))\r\n    this.middleware = new Middleware(this)\r\n  }\r\n\r\n  add (action, reducer) {\r\n    assert(\r\n      !this.reducers.find(v => v.action === action),\r\n      `Can't repeat defined [${action}] action.`,\r\n    )\r\n\r\n    const { partialState } = filterReducer(this.state, action, reducer)\r\n\r\n    reducer.action = action\r\n    this.reducers.push(reducer)\r\n    if (!isEmptyObject(partialState)) {\r\n      this.state = mergeState(this.state, partialState)\r\n    }\r\n  }\r\n\r\n  dispatch (action, payload, callback) {\r\n    const { reducers, isDispatching } = this\r\n\r\n    // if we in call dispatch process,\r\n    // we don't allow call dispacth again.\r\n    assert(\r\n      !isDispatching,\r\n      'It is not allowed to call \"dispatch\" during dispatch execution.' +\r\n        `\\n\\n   --- from [${action}] action.`\r\n    )\r\n\r\n    const reducer = reducers.find(v => v.action === action)\r\n\r\n    assert(\r\n      reducer,\r\n      `The [${action}] action does not exist. ` +\r\n        'Maybe you have not defined.'\r\n    )\r\n\r\n    // call all middleware\r\n    this.middleware.process(action, payload, (destPayload, restoreProcessState) => {\r\n      this.isDispatching = true\r\n\r\n      try {\r\n        let newPartialState\r\n        const namespace = reducer.namespace\r\n        const isModuleDispatch = typeof namespace === 'string'\r\n\r\n        if (isModuleDispatch) {\r\n          const module = this.getModule(namespace, true)\r\n          // generate new partial state\r\n          newPartialState = reducer.setter(module, destPayload, this.state)\r\n        } else {\r\n          newPartialState = reducer.setter(this.state, destPayload)\r\n        }\r\n\r\n        assert(\r\n          isPlainObject(newPartialState),\r\n          'setter function should be return a plain object.',\r\n        )\r\n        \r\n        // update global state\r\n        if (!isEmptyObject(newPartialState)) {\r\n          if (isModuleDispatch) {\r\n            this.state = mergeState(\r\n              this.state,\r\n              {\r\n                [namespace]: Object.assign(\r\n                  {},\r\n                  this.getModule(namespace),\r\n                  newPartialState,\r\n                ),\r\n              },\r\n            )\r\n          } else {\r\n            this.state = mergeState(\r\n              this.state,\r\n              newPartialState,\r\n            )\r\n          }\r\n        }\r\n      } finally {\r\n        // the `isDispatching` need restore.\r\n         this.isDispatching = false\r\n        // restore state\r\n        restoreProcessState()\r\n      }\r\n\r\n      // update components\r\n      updateComponents(this, callback)\r\n    })\r\n  }\r\n\r\n  // add middleware\r\n  use (action, fn) {\r\n    if (\r\n      typeof action === 'function' &&\r\n      action !== COMMONACTION\r\n    ) {\r\n      fn = action\r\n      action = COMMONACTION\r\n    }\r\n\r\n    this.middleware.use(action, fn)\r\n    return () => this.middleware.remove(action, fn)\r\n  }\r\n\r\n  // allow change `GLOBALWORD`.\r\n  setNamespace (key) {\r\n    assert(\r\n      key && typeof key === 'string',\r\n      'The [namespace] must be a string',\r\n    )\r\n    this.GLOBALWORD = key\r\n  }\r\n\r\n  // get module\r\n  getModule (namespace, needInspect) {\r\n    assert(\r\n      typeof namespace === 'string',\r\n      'the namespace mast be a string',\r\n    )\r\n\r\n    // deal with module state\r\n    const module = parsePath(namespace)(this.state)\r\n    // if the module does not meet the requirements\r\n    // throw error\r\n    if (needInspect && !(isPlainObject(module) && module.__mpModule)) {\r\n      warning(`The [${namespace}] module is not exist.`)\r\n    }\r\n    \r\n    return module\r\n  }\r\n\r\n  // insert method\r\n  rewirteCfgAndAddDep (config, isPage) {\r\n    let createState = null\r\n    const store = this\r\n    const GLOBALWORD = this.GLOBALWORD\r\n    const { data, storeConfig = {} } = config\r\n    const {\r\n      useState,\r\n      didUpdate,\r\n      willUpdate,\r\n      defineReducer,\r\n      travelLimit = 0, // default not open time travel function\r\n    } = storeConfig\r\n\r\n    assert(\r\n      typeof travelLimit === 'number',\r\n      `[travelLimit] must be a number, but now is [${typeof travelLimit}].`\r\n    )\r\n\r\n    delete config.storeConfig\r\n\r\n    // this is a uitl method,\r\n    // allow craete reducer in the page or component.\r\n    if (typeof defineReducer === 'function') {\r\n      defineReducer.call(store, store)\r\n    }\r\n\r\n    // get the global state words used\r\n    if (typeof useState === 'function') {\r\n      let namespace = null\r\n      let defineObject = null\r\n      const useConfig = useState.call(store, store)\r\n\r\n      // inspect should need module state\r\n      if (Array.isArray(useConfig)) {\r\n        namespace = useConfig[0]\r\n        defineObject = useConfig[1]\r\n      } else {\r\n        defineObject = useConfig\r\n      }\r\n\r\n      assert(\r\n        isPlainObject(defineObject),\r\n        '[useState] must return a plain object, ' +\r\n          `but now is return a [${typeof defineObject}]`,\r\n      )\r\n      \r\n      // need deep clone, otherwise the `data.global` on the back of the component cannot be changed.\r\n      createState = () => clone(mapObject(defineObject, fn => {\r\n        return namespace === null\r\n          ? fn(store.state)\r\n          : fn(this.getModule(namespace, true), store.state)\r\n      }))\r\n    }\r\n\r\n    // get state used by the current component\r\n    if (createState !== null) {\r\n      const useState = createState()\r\n      if (isPlainObject(useState)) {\r\n        data \r\n          ? data[GLOBALWORD] = useState\r\n          : config.data = { [GLOBALWORD]: useState }\r\n      }\r\n    }\r\n\r\n    const addDep = component => {\r\n      const shouldAdd = callHook(this.hooks, 'addDep', [component, isPage])\r\n\r\n      // if no used global state word,\r\n      // no need to add dependencies.\r\n      if (shouldAdd !== false && createState !== null) {\r\n        if (component.data && isPlainObject(component.data[GLOBALWORD])) {\r\n          // time travel can record diff patchs\r\n          component.timeTravel = new TimeTravel(component, GLOBALWORD, travelLimit)\r\n\r\n          // add component to depComponents\r\n          this.depComponents.push({\r\n            isPage,\r\n            component,\r\n            didUpdate,\r\n            willUpdate,\r\n            createState,\r\n          })\r\n\r\n          // if the global state is changed, need update component\r\n          const patchs = diff(component.data[GLOBALWORD], createState(), GLOBALWORD)\r\n          if (patchs.length > 0) {\r\n            applyPatchs(component, patchs, GLOBALWORD)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (isPage) {\r\n      config.onLoad = createWraper(\r\n        config.onLoad,\r\n        function () {\r\n          addDep(this)\r\n          // rigister store to component within\r\n          this.store = store\r\n        },\r\n      )\r\n      \r\n      config.onUnload = createWraper(\r\n        config.onUnload,\r\n        null,\r\n        function () {\r\n          // clear cache\r\n          remove(store.depComponents, this)\r\n        },\r\n      )\r\n    } else {\r\n      // Component\r\n      config.lifetimes = config.lifetimes || {}\r\n      const get = name => config[name] || config.lifetimes[name]\r\n      const set = (name, fn) => config[name] = config.lifetimes[name] = fn\r\n\r\n      set('attached', createWraper(\r\n        get('attached'),\r\n        function () {\r\n          addDep(this)\r\n          this.store = store\r\n        },\r\n      ))\r\n\r\n      set('detached', createWraper(\r\n        get('detached'),\r\n        null,\r\n        function () {\r\n          remove(store.depComponents, this)\r\n        },\r\n      ))\r\n    }\r\n  }\r\n}","import {\r\n  callHook,\r\n  mixinMethods,\r\n  createWraper,\r\n  isEmptyObject,\r\n} from './utils'\r\nimport mixin from './mixin'\r\nimport { Store } from './store'\r\nexport { clone } from './utils'\r\nexport { diff, restore } from './diff'\r\nexport { createModule } from './module'\r\n\r\nexport const version = __VERSION__\r\n\r\nconst nativePage = Page\r\nconst nativeComponent = Component\r\n\r\nfunction expandConfig (config, expandMethods, isPage) {\r\n  if (!isEmptyObject(expandMethods)) {\r\n    if (isPage) {\r\n      mixinMethods(config, expandMethods)\r\n    } else {\r\n      config.methods = config.methods || {}\r\n      mixinMethods(config.methods, expandMethods)\r\n    }\r\n  }\r\n}\r\n\r\nexport default function (mixinInject, hooks) {\r\n  const store = new Store(hooks)\r\n  const expandMethods = mixin(mixinInject)\r\n\r\n  // we can rewirte Page and Component function\r\n  // this will be better compatible with previous project\r\n  Page = createWraper(\r\n    nativePage,\r\n    function (config) {\r\n      // we allow add additional config attributes\r\n      callHook(hooks, 'createBefore', [config, true])\r\n\r\n      expandConfig(config, expandMethods, true)\r\n    \r\n      // the store will record all page and component\r\n      // when global state changed, the dependent components will be update\r\n      store.rewirteCfgAndAddDep(config, true)\r\n    },\r\n  )\r\n\r\n  Component = createWraper(\r\n    nativeComponent,\r\n    function (config) {\r\n      callHook(hooks, 'createBefore', [config, false])\r\n\r\n      expandConfig(config, expandMethods, false)\r\n      store.rewirteCfgAndAddDep(config, false)\r\n    },\r\n  )\r\n\r\n  return store\r\n}"],"names":[],"mappings":"AAAO,SAAS,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE;EACzC,OAAO,GAAG,CAAC,uBAAuB,EAAE,OAAO,CAAC,IAAI,EAAC;EACjD,IAAI,OAAO,EAAE;IACX,OAAO,CAAC,IAAI,CAAC,OAAO,EAAC;IACrB,MAAM;GACP;EACD,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC;CACzB;AAED,AAAO,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE;EAC1C,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,OAAO,EAAC;CACjC;AAED,AAAO,SAAS,WAAW,EAAE,KAAK,EAAE;EAClC;IACE,OAAO,KAAK,KAAK,QAAQ;IACzB,OAAO,KAAK,KAAK,QAAQ;IACzB,OAAO,KAAK,KAAK,QAAQ;IACzB,OAAO,KAAK,KAAK,SAAS;GAC3B;CACF;AAED,AAAO,SAAS,UAAU,EAAE,KAAK,EAAE;EACjC,MAAM,KAAK,GAAG,MAAM,CAAC,mBAAmB,CAAC,KAAK,EAAC;EAC/C,IAAI,GAAG,GAAG,KAAK,CAAC,OAAM;EACtB,OAAO,CAAC,GAAG,EAAE,EAAE;IACb,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,EAAC;IAC/B,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,EAAE;MAC/C,UAAU,CAAC,KAAK,EAAC;KAClB;GACF;EACD,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC;CAC5B;AAED,AAAO,SAAS,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE;EAC9C,OAAO,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;CACzD;AAED,AAAO,SAAS,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE;EAC7C,KAAK,MAAM,GAAG,IAAI,OAAO,EAAE;IACzB,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,EAAE;MACpB,MAAM,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,GAAG,EAAC;KAC3B;GACF;CACF;AAED,AAAO,SAAS,YAAY,CAAC,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE;EAC1D,KAAK,MAAM,GAAG,IAAI,YAAY,EAAE;IAC9B,MAAM,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,EAAC;GAClD;CACF;AAGD,AAAO,SAAS,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;EACvC,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS,EAAC;EAClE,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE;IACd,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,EAAC;GACtB;CACF;AAED,AAAO,SAAS,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE;EAC3C,IAAI,KAAK,IAAI,OAAO,KAAK,CAAC,IAAI,CAAC,KAAK,UAAU,EAAE;IAC9C,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC;GACtC;CACF;AAED,AAAO,SAAS,aAAa,EAAE,GAAG,EAAE;EAClC,KAAK,MAAM,CAAC,IAAI,GAAG,CAAC;IAClB,OAAO,KAAK;GACb;EACD,OAAO,IAAI;CACZ;AAED,AAAO,SAAS,SAAS,EAAE,GAAG,EAAE,EAAE,EAAE;EAClC,MAAM,UAAU,GAAG,GAAE;EACrB,KAAK,MAAM,GAAG,IAAI,GAAG,EAAE;IACrB,IAAI,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;MAC3B,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,EAAC;KAC/B;GACF;EACD,OAAO,UAAU;CAClB;AAED,AAAO,SAAS,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE;EACnD,OAAO,UAAU,GAAG,IAAI,EAAE;IACxB,IAAI,OAAM;IAEV,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;MAChC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAC;KACzB;IAED,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;MAChC,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAC;KAClC;IAED,IAAI,OAAO,KAAK,KAAK,UAAU,EAAE;MAC/B,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAC;KACxB;IAED,OAAO,MAAM;GACd;CACF;AAED,AAAO,SAAS,aAAa,EAAE,GAAG,EAAE;EAClC,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE,OAAO,KAAK;EAEzD,MAAM,KAAK,GAAG,MAAM,CAAC,cAAc,CAAC,GAAG,EAAC;EACxC,IAAI,KAAK,KAAK,IAAI,EAAE,OAAO,IAAI;EAE/B,IAAI,SAAS,GAAG,MAAK;EACrB,OAAO,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,KAAK,IAAI,EAAE;IAChD,SAAS,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,EAAC;GAC7C;EACD,OAAO,KAAK,KAAK,SAAS;CAC3B;AAED,AAAO,SAAS,KAAK,EAAE,KAAK,EAAE,MAAM,GAAG,IAAI,OAAO,EAAE;EAClD;IACE,KAAK,KAAK,IAAI;IACd,KAAK,KAAK,SAAS;IACnB,WAAW,CAAC,KAAK,CAAC;IAClB,OAAO,KAAK,KAAK,UAAU;IAC3B,KAAK,YAAY,IAAI;IACrB;IACA,OAAO,KAAK;GACb;EAED,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC;EAE/C,MAAM,MAAM,GAAG,OAAO,KAAK,CAAC,WAAW,KAAK,UAAU;MAClD,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;MACnB,IAAI,KAAK,CAAC,WAAW,GAAE;EAE3B,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,EAAC;EAEzB,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;IACvB,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,MAAM,EAAC;GACxC;EAED,OAAO,MAAM;CACd;AAGD,AAAO,SAAS,SAAS,EAAE,IAAI,EAAE;EAC/B,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,EAAC;EAChC,OAAO,UAAU,GAAG,EAAE;IACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;MACnD,IAAI,CAAC,GAAG,EAAE,MAAM;MAChB,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAC;KACvB;IACD,OAAO,GAAG;GACX;;;ACrJY,cAAQ,EAAE,MAAM,EAAE;EAC/B,MAAM,aAAa,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,EAAC;EAEzC,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;IAChC,MAAM,QAAQ,GAAG,CAAC,IAAI,EAAE,EAAE,KAAK;MAC7B,MAAM;QACJ,OAAO,IAAI,KAAK,QAAQ;QACxB,CAAC,oCAAoC,CAAC;QACvC;MAED,MAAM;QACJ,OAAO,EAAE,KAAK,UAAU;QACxB,qCAAqC;QACtC;MAED,MAAM;QACJ,EAAE,IAAI,IAAI,aAAa,CAAC;QACxB,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,AAE3B,EAAC;MAED,aAAa,CAAC,IAAI,CAAC,GAAG,GAAE;MACzB;IAED,MAAM,CAAC,QAAQ,EAAC;GACjB;EACD,OAAO,aAAa;;;ACvBf,MAAM,WAAW,GAAG,aAAY;AAEvC,AAAO,SAAS,QAAQ,EAAE,CAAC,EAAE;EAC3B,OAAO,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,KAAK,IAAI;CACnD;AAED,AAAO,SAAS,SAAS,EAAE,KAAK,EAAE,SAAS,EAAE;EAC3C,OAAO,SAAS;MACZ,SAAS,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;MAC3B,KAAK;CACV;AAED,AAoBO,SAAS,YAAY,EAAE,GAAG,EAAE;EACjC,MAAM;IACJ,aAAa,CAAC,GAAG,CAAC;IAClB,gDAAgD;IACjD;EAED,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE,OAAO,GAAG;EAE7B,MAAM;IACJ,EAAE,WAAW,IAAI,GAAG,CAAC;IACrB,CAAC,KAAK,EAAE,WAAW,CAAC,wDAAwD,CAAC;IAC9E;EAED,GAAG,CAAC,WAAW,CAAC,GAAG,KAAI;EACvB,OAAO,GAAG;CACX;;ACpDM,MAAM,GAAG,GAAG,EAAC;AACpB,AAAO,MAAM,MAAM,GAAG,EAAC;AACvB,AAAO,MAAM,OAAO,GAAG,EAAC;AAExB,SAAS,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE;EAC5C,IAAI,CAAC,IAAI,GAAG,KAAI;EAChB,IAAI,CAAC,IAAI,GAAG,KAAI;EAChB,IAAI,CAAC,KAAK,GAAG,MAAK;EAClB,IAAI,CAAC,SAAS,GAAG,UAAS;CAC3B;AAGD,SAAS,UAAU,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE;EAE9C,IAAI,OAAO,IAAI,KAAK,UAAU,IAAI,IAAI,KAAK,IAAI,EAAE;IAC/C,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,EAAC;GACnD,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;IAE9B,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;MACxB,SAAS,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAC;KACrC,MAAM;MACL,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,EAAC;KACnD;GACF,MAAM,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;IAEnC;QACI,KAAK,KAAK,IAAI;QACd,OAAO,KAAK,KAAK,QAAQ;QACzB,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;MACvB;MAEA,IAAI,IAAI,YAAY,IAAI,IAAI,KAAK,YAAY,IAAI,EAAE;QACjD,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,EAAC;OACnD,MAAM;QACL,UAAU,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAC;OACtC;KACF,MAAM;MACL,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,EAAC;KACnD;GACF,MAAM;IACL,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,EAAC;GACnD;CACF;AAGD,SAAS,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE;EACtC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,MAAM,EAAE;IACxB,IAAI,GAAG,GAAG,CAAC,CAAC,OAAM;IAClB,OAAO,CAAC,EAAE,GAAG,EAAE;MACb,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,EAAE;QACrB,MAAM,IAAI,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAC;QAC9B,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,MAAM,EAAC;OACzC;KACF;IAED,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,EAAE;MACvB,GAAG,GAAG,CAAC,CAAC,OAAM;MACd,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC,MAAM,EAAE;QACxB,MAAM,IAAI,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAC;QAC9B,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,EAAC;OAClD;KACF;GACF,MAAM;IAGL,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC;GAC5C;CACF;AAED,SAAS,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE;EAEvC,KAAK,MAAM,GAAG,IAAI,CAAC,EAAE;IAEnB,MAAM,IAAI,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC,EAAC;IAE7B,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC,EAAE;MACf,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,EAAC;KACnD,MAAM,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,EAAE;MAC5B,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,MAAM,EAAC;KAKzC;GACF;EAGD,KAAK,MAAM,GAAG,IAAI,CAAC,EAAE;IACnB,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC,EAAE;MACf,MAAM,IAAI,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC,EAAC;MAC7B,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,EAAC;KAChD;GACF;CACF;AAGD,AAAO,SAAS,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE;EACpC,MAAM,MAAM,GAAG,GAAE;EACjB,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAC;EAClC,OAAO,MAAM;CACd;AAED,MAAM,GAAG,GAAG,wBAAuB;AAGnC,SAAS,YAAY,EAAE,GAAG,EAAE,IAAI,EAAE;EAChC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,EAAC;EAG5B,IAAI,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;IAC3C,IAAI,CAAC,GAAG,CAAC,EAAC;IACV,IAAI,GAAG,GAAG,KAAI;IACd,IAAI,MAAM,GAAG,IAAG;IAChB,IAAI,UAAU,GAAG,KAAI;IAErB,OAAO,CAAC,EAAE,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;MAC5B,UAAU,GAAG,OAAM;MACnB,GAAG,GAAG,IAAI,CAAC,CAAC,EAAC;MACb,MAAM,GAAG,MAAM,CAAC,GAAG,EAAC;KACrB;IAED,OAAO,CAAC,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;GACvD;CACF;AAED,AAAO,SAAS,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE;EACpC,IAAI,GAAG,GAAG,MAAM,CAAC,OAAM;EACvB,MAAM,YAAY,GAAG,IAAI,GAAG,GAAE;EAE9B,OAAO,CAAC,EAAE,GAAG,EAAE;IACb,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,MAAM,CAAC,GAAG,EAAC;IAE7C,MAAM,SAAS,GAAG,YAAY,CAAC,GAAG,EAAE,IAAI,GAAG,GAAG,EAAC;IAE/C,IAAI,SAAS,EAAE;MACb,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,OAAO,CAAC,GAAG,UAAS;MAGpD,QAAQ,IAAI;QACV,KAAK,MAAM;UACT,MAAM,CAAC,OAAO,CAAC,GAAG,UAAS;UAC3B,KAAK;QACP,KAAK,OAAO;UACV,MAAM,CAAC,OAAO,CAAC,GAAG,UAAS;UAC3B,KAAK;QACP,KAAK,GAAG;UACN,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,KAAK,UAAU,CAAC,GAAG,CAAC,EAAE;YACvD,YAAY,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,GAAG,EAAE,UAAU,EAAE,EAAC;WAC9C;UACD,OAAO,MAAM,CAAC,OAAO,EAAC;UACtB,KAAK;OACR;KACF;GACF;EAED,YAAY,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,EAAE,MAAM,KAAK;IACpD,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,WAAW,GAAE;IAEtC,MAAM,CAAC,OAAO,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAC;IACxC,UAAU,CAAC,GAAG,CAAC,GAAG,MAAK;GACxB,EAAC;EAEF,OAAO,GAAG;;;AC/JL,SAAS,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE;EACxD,MAAM,UAAU,GAAG,GAAE;EAErB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;IACjD,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC,CAAC,EAAC;IACjC,UAAU,CAAC,IAAI,CAAC,GAAG,MAAK;GACzB;EAED,SAAS,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,EAAC;CACxC;AAGD,AAAO,SAAS,gBAAgB,EAAE,KAAK,EAAE,QAAQ,EAAE;EACjD,IAAI,KAAK,GAAG,EAAC;EACb,MAAM;IACJ,KAAK;IACL,UAAU;IACV,aAAa;GACd,GAAG,MAAK;EACT,MAAM,GAAG,GAAG,aAAa,CAAC,OAAM;EAEhC,IAAI,GAAG,KAAK,CAAC,EAAE;IACb,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;MAClC,QAAQ,GAAE;KACX;IACD,MAAM;GACP;EAGD,MAAM,gBAAgB,GAAG,MAAM;IAC7B,IAAI,EAAE,KAAK,KAAK,GAAG,EAAE;MACnB,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;QAClC,QAAQ,GAAE;OACX;KACF;IACF;EAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;IAC5B,MAAM;MACJ,MAAM;MACN,SAAS;MACT,SAAS;MACT,UAAU;MACV,WAAW;KACZ,GAAG,aAAa,CAAC,CAAC,EAAC;IAEpB,IAAI,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;MAC9B,MAAM,eAAe,GAAG,WAAW,GAAE;MAGrC,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;QACpC,IAAI,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,SAAS,EAAE,eAAe,CAAC,KAAK,KAAK,EAAE;UAChE,gBAAgB,GAAE;UAClB,QAAQ;SACT;OACF;MAID,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,eAAe,EAAE,UAAU,EAAC;MAE5E,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;QAErB,MAAM,MAAM,GAAG,CAAC,SAAS,EAAE,eAAe,EAAE,MAAM,EAAE,MAAM,EAAC;QAC3D,IAAI,QAAQ,CAAC,KAAK,EAAE,YAAY,EAAE,MAAM,CAAC,KAAK,KAAK,EAAE;UACnD,gBAAgB,GAAE;UAClB,QAAQ;SACT;QAGD,WAAW,CAAC,SAAS,EAAE,MAAM,EAAE,gBAAgB,EAAC;QAEhD,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE;UACnC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,SAAS,EAAE,eAAe,EAAE,MAAM,EAAC;SAC1D;QAED,QAAQ,CAAC,KAAK,EAAE,WAAW,EAAE,CAAC,SAAS,EAAE,eAAe,EAAE,MAAM,CAAC,EAAC;QAGlE,IAAI,SAAS,CAAC,UAAU,EAAE;UACxB,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,EAAC;SAClC;OACF,MAAM;QACL,gBAAgB,GAAE;OACnB;KACF,MAAM;MACL,gBAAgB,GAAE;KACnB;GACF;;;ACvFY,MAAM,UAAU,CAAC;EAC9B,WAAW,CAAC,CAAC,SAAS,EAAE,UAAU,EAAE,KAAK,EAAE;IACzC,IAAI,CAAC,OAAO,GAAG,GAAE;IACjB,IAAI,CAAC,KAAK,GAAG,MAAK;IAClB,IAAI,CAAC,SAAS,GAAG,UAAS;IAC1B,IAAI,CAAC,UAAU,GAAG,WAAU;IAC5B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,OAAM;IACjC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,OAAM;IAClC,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,IAAI,CAAC,UAAU,EAAC;GAC/C;EAID,IAAI,CAAC,CAAC,MAAM,EAAE;IACZ,MAAM;MACJ,KAAK;MACL,OAAO;MACP,UAAU;MACV,OAAO,EAAE,EAAE,MAAM,EAAE;MACnB,SAAS,EAAE,EAAE,IAAI,EAAE;KACpB,GAAG,KAAI;IAER,IAAI,KAAK,GAAG,CAAC,EAAE;MAEb,MAAM,UAAU,GAAG,MAAM,GAAG,MAAK;MACjC,IAAI,UAAU,IAAI,CAAC,EAAE;QACnB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,UAAU,GAAG,CAAC,EAAC;OACvC;MAED,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAC;MACzB,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,OAAM;MAC5B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAM;MAE7B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,EAAC;KAC5C;GACF;EAED,EAAE,CAAC,CAAC,CAAC,EAAE;IACL,MAAM;MACJ,OAAO;MACP,OAAO;MACP,SAAS;MACT,UAAU;MACV,YAAY;KACb,GAAG,KAAI;IAER,MAAM;MACJ,UAAU,IAAI,SAAS,CAAC,IAAI;MAC5B,sEAAsE;MACvE;IAED,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;MAClB,IAAI,CAAC,KAAK,CAAC,EAAE;QACX,MAAM,KAAK,GAAG,CAAC,GAAG,QAAO;QACzB,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAC;QAE7B,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,OAAO,CAAC,MAAM,EAAE;UACvC,OAAO,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,kCAAkC,CAAC,EAAE,IAAI,EAAC;UAClE,MAAM;SACP;QAED,IAAI,KAAK,GAAG,EAAC;QAEb,IAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAC;QAE5C,MAAM,KAAK,EAAE,GAAG,SAAS,EAAE;UACzB,MAAM,EAAE,GAAG,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,MAAK;UACzC,IAAI,EAAE,GAAG,OAAO,CAAC,MAAM,EAAE;YACvB,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,EAAC;YACjC,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,MAAM,EAAC;WAC7B,MAAM;YACL,IAAI,GAAG,aAAY;WACpB;SACF;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,IAAI,EAAE,UAAU,EAAC;QACpE,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;UACxB,WAAW,CAAC,SAAS,EAAE,SAAS,EAAC;SAClC;QAED,IAAI,CAAC,OAAO,IAAI,EAAC;OAClB;KACF;GACF;EAED,OAAO,CAAC,GAAG;IACT,IAAI,CAAC,EAAE,CAAC,CAAC,EAAC;GACX;EAED,IAAI,CAAC,GAAG;IACN,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,EAAC;GACZ;EAED,OAAO,CAAC,GAAG;IACT,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,EAAC;GACvB;EAED,KAAK,CAAC,GAAG;IACP,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,EAAC;GAC5C;;;ACrGI,MAAM,YAAY,GAAG,MAAM,GAAE;AAEpC,SAAS,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE;EAC7B,IAAI,KAAK,CAAC,MAAM,KAAK,YAAY,EAAE,OAAO,IAAI;EAC9C,OAAO,MAAM,KAAK,KAAK,CAAC,MAAM;CAC/B;AAED,SAAS,WAAW;EAClB,MAAM;EACN,EAAE;EACF,KAAK;EACL,OAAO;EACP,IAAI;EACJ,mBAAmB;EACnB;EACA,IAAI;IACF,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,EAAC;IACrC,mBAAmB,GAAE;GACtB,CAAC,OAAO,KAAK,EAAE;IACd,MAAM,KAAK,GAAG,KAAK,CAAC,MAAK;IACzB,mBAAmB,GAAE;IAGrB,IAAI,KAAK,IAAI,OAAO,KAAK,CAAC,iBAAiB,CAAC,KAAK,UAAU,EAAE;MAC3D,KAAK,CAAC,iBAAiB,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,KAAK,EAAC;KACjD,MAAM;MACL,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,4BAA4B,EAAE,MAAM,CAAC,SAAS,CAAC,EAAC;KAClE;GACF;CACF;AAGD,AAAO,MAAM,UAAU,CAAC;EACtB,WAAW,CAAC,CAAC,KAAK,EAAE;IAClB,IAAI,CAAC,KAAK,GAAG,GAAE;IACf,IAAI,CAAC,KAAK,GAAG,MAAK;IAClB,IAAI,CAAC,YAAY,GAAG,MAAK;GAC1B;EAED,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,EAAE;IACf,MAAM;MACJ,CAAC,IAAI,CAAC,YAAY;MAClB,+DAA+D;MAChE;IACD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,EAAC;GAChC;EAED,MAAM,CAAC,CAAC,MAAM,EAAE,EAAE,EAAE;IAClB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI;MAC1C,OAAO,KAAK,CAAC,EAAE,KAAK,EAAE,IAAI,KAAK,CAAC,MAAM,KAAK,MAAM;KAClD,EAAC;IAEF,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE;MACd,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,EAAC;KAC5B;GACF;EAED,OAAO,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE;IAEhC,IAAI,CAAC,YAAY,GAAG,KAAI;IACxB,MAAM,mBAAmB,GAAG,MAAM;MAChC,IAAI,CAAC,YAAY,GAAG,MAAK;MAC1B;IAED,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;MACzB,IAAI,KAAK,GAAG,EAAC;MACb,MAAM,IAAI,GAAG,WAAW,IAAI;QAC1B,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAC;QAE7B,KAAK,GAAE;QAEP,OAAO,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,CAAC,EAAE;UACrC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,EAAC;SAC5B;QAED,IAAI,KAAK,EAAE;UAGT,WAAW;YACT,MAAM;YACN,KAAK,CAAC,EAAE;YACR,IAAI,CAAC,KAAK;YACV,WAAW;YACX,IAAI;YACJ,mBAAmB;YACpB;SACF,MAAM;UACL,MAAM,CAAC,WAAW,EAAE,mBAAmB,EAAC;SACzC;QACF;MAED,IAAI,CAAC,OAAO,EAAC;KACd,MAAM;MACL,MAAM,CAAC,OAAO,EAAE,mBAAmB,EAAC;KACrC;GACF;;;ACpEH,IAAI,OAAO,GAAG,EAAC;AAEf,SAAS,aAAa,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE;EAC9C,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG,QAAO;EAEnD,MAAM;IACJ,cAAc,IAAI,OAAO;IACzB,CAAC,gCAAgC,CAAC;MAChC,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC;IACtC;EAED,MAAM;IACJ,aAAa,CAAC,YAAY,CAAC;IAC3B,CAAC,qCAAqC,CAAC;MACrC,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC;IACtC;EAED,IAAI,WAAW,IAAI,OAAO,EAAE;IAC1B,MAAM;MACJ,OAAO,SAAS,KAAK,QAAQ;MAC7B,wCAAwC;QACtC,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC;MACtC;IAED,MAAM,MAAM,GAAG,SAAS,CAAC,KAAK,EAAE,SAAS,AAAQ,EAAC;AAEtD,AAMA,GAAG,MAAM;IAEL,YAAY,CAAC,YAAY,EAAE,KAAK,EAAE,GAAG,IAAI;MACvC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,kCAAkC,CAAC;QACpD,CAAC,4CAA4C,EAAE,MAAM,CAAC,SAAS,CAAC;KACnE,EAAC;IAGF,IAAI,QAAQ,CAAC,YAAY,CAAC,EAAE,CAE3B;GACF;EAED,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;IAChC,OAAO,CAAC,MAAM,GAAG,MAAM;MACrB,OAAO;QACL,CAAC,gBAAgB,EAAE,MAAM,CAAC,0CAA0C,CAAC;UACnE,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC;QACtC;MACF;GACF;EACD,OAAO,OAAO;CACf;AAED,AAAO,MAAM,KAAK,CAAC;EACjB,WAAW,CAAC,CAAC,KAAK,EAAE;IAClB,IAAI,CAAC,KAAK,GAAG,MAAK;IAClB,IAAI,CAAC,QAAQ,GAAG,GAAE;IAClB,IAAI,CAAC,EAAE,GAAG,EAAE,QAAO;IACnB,IAAI,CAAC,aAAa,GAAG,GAAE;IACvB,IAAI,CAAC,UAAU,GAAG,SAAQ;IAC1B,IAAI,CAAC,aAAa,GAAG,MAAK;IAC1B,IAAI,CAAC,OAAO,GAAG,SAAW;IAC1B,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,EAAC;IAC5C,IAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,IAAI,EAAC;GACvC;EAED,GAAG,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE;IACpB,MAAM;MACJ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC;MAC7C,CAAC,sBAAsB,EAAE,MAAM,CAAC,SAAS,CAAC;MAC3C;IAED,MAAM,EAAE,YAAY,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAC;IAEnE,OAAO,CAAC,MAAM,GAAG,OAAM;IACvB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAC;IAC3B,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;MAChC,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,EAAC;KAClD;GACF;EAED,QAAQ,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE;IACnC,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,KAAI;IAIxC,MAAM;MACJ,CAAC,aAAa;MACd,iEAAiE;QAC/D,CAAC,iBAAiB,EAAE,MAAM,CAAC,SAAS,CAAC;MACxC;IAED,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,EAAC;IAEvD,MAAM;MACJ,OAAO;MACP,CAAC,KAAK,EAAE,MAAM,CAAC,yBAAyB,CAAC;QACvC,6BAA6B;MAChC;IAGD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE,CAAC,WAAW,EAAE,mBAAmB,KAAK;MAC7E,IAAI,CAAC,aAAa,GAAG,KAAI;MAEzB,IAAI;QACF,IAAI,gBAAe;QACnB,MAAM,SAAS,GAAG,OAAO,CAAC,UAAS;QACnC,MAAM,gBAAgB,GAAG,OAAO,SAAS,KAAK,SAAQ;QAEtD,IAAI,gBAAgB,EAAE;UACpB,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAC;UAE9C,eAAe,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,KAAK,EAAC;SAClE,MAAM;UACL,eAAe,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,WAAW,EAAC;SAC1D;QAED,MAAM;UACJ,aAAa,CAAC,eAAe,CAAC;UAC9B,kDAAkD;UACnD;QAGD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,EAAE;UACnC,IAAI,gBAAgB,EAAE;YACpB,IAAI,CAAC,KAAK,GAAG,UAAU;cACrB,IAAI,CAAC,KAAK;cACV;gBACE,CAAC,SAAS,GAAG,MAAM,CAAC,MAAM;kBACxB,EAAE;kBACF,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;kBACzB,eAAe;iBAChB;eACF;cACF;WACF,MAAM;YACL,IAAI,CAAC,KAAK,GAAG,UAAU;cACrB,IAAI,CAAC,KAAK;cACV,eAAe;cAChB;WACF;SACF;OACF,SAAS;SAEP,IAAI,CAAC,aAAa,GAAG,MAAK;QAE3B,mBAAmB,GAAE;OACtB;MAGD,gBAAgB,CAAC,IAAI,EAAE,QAAQ,EAAC;KACjC,EAAC;GACH;EAGD,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,EAAE;IACf;MACE,OAAO,MAAM,KAAK,UAAU;MAC5B,MAAM,KAAK,YAAY;MACvB;MACA,EAAE,GAAG,OAAM;MACX,MAAM,GAAG,aAAY;KACtB;IAED,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,EAAC;IAC/B,OAAO,MAAM,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC;GAChD;EAGD,YAAY,CAAC,CAAC,GAAG,EAAE;IACjB,MAAM;MACJ,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ;MAC9B,kCAAkC;MACnC;IACD,IAAI,CAAC,UAAU,GAAG,IAAG;GACtB;EAGD,SAAS,CAAC,CAAC,SAAS,EAAE,WAAW,EAAE;IACjC,MAAM;MACJ,OAAO,SAAS,KAAK,QAAQ;MAC7B,gCAAgC;MACjC;IAGD,MAAM,MAAM,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,KAAK,EAAC;IAG/C,IAAI,WAAW,IAAI,EAAE,aAAa,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,UAAU,CAAC,EAAE;MAChE,OAAO,CAAC,CAAC,KAAK,EAAE,SAAS,CAAC,sBAAsB,CAAC,EAAC;KACnD;IAED,OAAO,MAAM;GACd;EAGD,mBAAmB,CAAC,CAAC,MAAM,EAAE,MAAM,EAAE;IACnC,IAAI,WAAW,GAAG,KAAI;IACtB,MAAM,KAAK,GAAG,KAAI;IAClB,MAAM,UAAU,GAAG,IAAI,CAAC,WAAU;IAClC,MAAM,EAAE,IAAI,EAAE,WAAW,GAAG,EAAE,EAAE,GAAG,OAAM;IACzC,MAAM;MACJ,QAAQ;MACR,SAAS;MACT,UAAU;MACV,aAAa;MACb,WAAW,GAAG,CAAC;KAChB,GAAG,YAAW;IAEf,MAAM;MACJ,OAAO,WAAW,KAAK,QAAQ;MAC/B,CAAC,4CAA4C,EAAE,OAAO,WAAW,CAAC,EAAE,CAAC;MACtE;IAED,OAAO,MAAM,CAAC,YAAW;IAIzB,IAAI,OAAO,aAAa,KAAK,UAAU,EAAE;MACvC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,EAAC;KACjC;IAGD,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;MAClC,IAAI,SAAS,GAAG,KAAI;MACpB,IAAI,YAAY,GAAG,KAAI;MACvB,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,EAAC;MAG7C,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;QAC5B,SAAS,GAAG,SAAS,CAAC,CAAC,EAAC;QACxB,YAAY,GAAG,SAAS,CAAC,CAAC,EAAC;OAC5B,MAAM;QACL,YAAY,GAAG,UAAS;OACzB;MAED,MAAM;QACJ,aAAa,CAAC,YAAY,CAAC;QAC3B,yCAAyC;UACvC,CAAC,qBAAqB,EAAE,OAAO,YAAY,CAAC,CAAC,CAAC;QACjD;MAGD,WAAW,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,YAAY,EAAE,EAAE,IAAI;QACtD,OAAO,SAAS,KAAK,IAAI;YACrB,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC;YACf,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC;OACrD,CAAC,EAAC;KACJ;IAGD,IAAI,WAAW,KAAK,IAAI,EAAE;MACxB,MAAM,QAAQ,GAAG,WAAW,GAAE;MAC9B,IAAI,aAAa,CAAC,QAAQ,CAAC,EAAE;QAC3B,IAAI;YACA,IAAI,CAAC,UAAU,CAAC,GAAG,QAAQ;YAC3B,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC,UAAU,GAAG,QAAQ,GAAE;OAC7C;KACF;IAED,MAAM,MAAM,GAAG,SAAS,IAAI;MAC1B,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,CAAC,SAAS,EAAE,MAAM,CAAC,EAAC;MAIrE,IAAI,SAAS,KAAK,KAAK,IAAI,WAAW,KAAK,IAAI,EAAE;QAC/C,IAAI,SAAS,CAAC,IAAI,IAAI,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE;UAE/D,SAAS,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAC;UAGzE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;YACtB,MAAM;YACN,SAAS;YACT,SAAS;YACT,UAAU;YACV,WAAW;WACZ,EAAC;UAGF,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,WAAW,EAAE,EAAE,UAAU,EAAC;UAC1E,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;YACrB,WAAW,CAAC,SAAS,EAAE,MAAM,EAAE,UAAU,EAAC;WAC3C;SACF;OACF;MACF;IAED,IAAI,MAAM,EAAE;MACV,MAAM,CAAC,MAAM,GAAG,YAAY;QAC1B,MAAM,CAAC,MAAM;QACb,YAAY;UACV,MAAM,CAAC,IAAI,EAAC;UAEZ,IAAI,CAAC,KAAK,GAAG,MAAK;SACnB;QACF;MAED,MAAM,CAAC,QAAQ,GAAG,YAAY;QAC5B,MAAM,CAAC,QAAQ;QACf,IAAI;QACJ,YAAY;UAEV,MAAM,CAAC,KAAK,CAAC,aAAa,EAAE,IAAI,EAAC;SAClC;QACF;KACF,MAAM;MAEL,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,IAAI,GAAE;MACzC,MAAM,GAAG,GAAG,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,SAAS,CAAC,IAAI,EAAC;MAC1D,MAAM,GAAG,GAAG,CAAC,IAAI,EAAE,EAAE,KAAK,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAE;MAEpE,GAAG,CAAC,UAAU,EAAE,YAAY;QAC1B,GAAG,CAAC,UAAU,CAAC;QACf,YAAY;UACV,MAAM,CAAC,IAAI,EAAC;UACZ,IAAI,CAAC,KAAK,GAAG,MAAK;SACnB;OACF,EAAC;MAEF,GAAG,CAAC,UAAU,EAAE,YAAY;QAC1B,GAAG,CAAC,UAAU,CAAC;QACf,IAAI;QACJ,YAAY;UACV,MAAM,CAAC,KAAK,CAAC,aAAa,EAAE,IAAI,EAAC;SAClC;OACF,EAAC;KACH;GACF;;;AC5VS,MAAC,OAAO,GAAG,SAAW;AAElC,MAAM,UAAU,GAAG,KAAI;AACvB,MAAM,eAAe,GAAG,UAAS;AAEjC,SAAS,YAAY,EAAE,MAAM,EAAE,aAAa,EAAE,MAAM,EAAE;EACpD,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,EAAE;IACjC,IAAI,MAAM,EAAE;MACV,YAAY,CAAC,MAAM,EAAE,aAAa,EAAC;KACpC,MAAM;MACL,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,GAAE;MACrC,YAAY,CAAC,MAAM,CAAC,OAAO,EAAE,aAAa,EAAC;KAC5C;GACF;CACF;AAED,AAAe,cAAQ,EAAE,WAAW,EAAE,KAAK,EAAE;EAC3C,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,EAAC;EAC9B,MAAM,aAAa,GAAG,KAAK,CAAC,WAAW,EAAC;EAIxC,IAAI,GAAG,YAAY;IACjB,UAAU;IACV,UAAU,MAAM,EAAE;MAEhB,QAAQ,CAAC,KAAK,EAAE,cAAc,EAAE,CAAC,MAAM,EAAE,IAAI,CAAC,EAAC;MAE/C,YAAY,CAAC,MAAM,EAAE,aAAa,EAAE,IAAI,EAAC;MAIzC,KAAK,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,EAAC;KACxC;IACF;EAED,SAAS,GAAG,YAAY;IACtB,eAAe;IACf,UAAU,MAAM,EAAE;MAChB,QAAQ,CAAC,KAAK,EAAE,cAAc,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,EAAC;MAEhD,YAAY,CAAC,MAAM,EAAE,aAAa,EAAE,KAAK,EAAC;MAC1C,KAAK,CAAC,mBAAmB,CAAC,MAAM,EAAE,KAAK,EAAC;KACzC;IACF;EAED,OAAO,KAAK;;;;;;"}