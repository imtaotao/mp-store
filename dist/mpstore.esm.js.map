{"version":3,"file":"mpstore.esm.js","sources":["../src/utils.js","../src/mixin.js","../src/module.js","../src/diff.js","../src/update.js","../src/time-travel.js","../src/middleware.js","../src/store.js","../src/index.js"],"sourcesContent":["export function warning (message, noError) {\r\n  message = `\\n\\n[MpStore warning]: ${message}\\n\\n`\r\n  if (noError) {\r\n    console.warn(message)\r\n    return\r\n  }\r\n  throw new Error(message)\r\n}\r\n\r\nexport function assert (condition, message) {\r\n  if (!condition) warning(message)\r\n}\r\n\r\nexport function isPrimitive (value) {\r\n  return (\r\n    typeof value === 'string' ||\r\n    typeof value === 'number' ||\r\n    typeof value === 'symbol' ||\r\n    typeof value === 'boolean'\r\n  )\r\n}\r\n\r\nexport function deepFreeze (state) {\r\n  const names = Object.getOwnPropertyNames(state)\r\n  let len = names.length\r\n  while (~len--) {\r\n    const value = state[names[len]]\r\n    if (typeof value === 'object' && value !== null) {\r\n      deepFreeze(value)\r\n    }\r\n  }\r\n  return Object.freeze(state)\r\n}\r\n\r\nexport function mergeState (oldState, newState) {\r\n  return deepFreeze(Object.assign({}, oldState, newState))\r\n}\r\n\r\nexport function mixinMethods (config, methods) {\r\n  for (const key in methods) {\r\n    if (!(key in config)) {\r\n      config[key] = methods[key]\r\n    }\r\n  }\r\n}\r\n\r\nexport function inspectState(partialState, state, sendWarn) {\r\n  for (const key in partialState) {\r\n    assert(!state.hasOwnProperty(key), sendWarn(key))\r\n  }\r\n}\r\n\r\n// remove component from depsComponent\r\nexport function remove (list, component) {\r\n  const index = list.findIndex(item => item.component === component)\r\n  if (index > -1) {\r\n    list.splice(index, 1)\r\n  }\r\n}\r\n\r\nexport function callHook (hooks, name, args) {\r\n  if (hooks && typeof hooks[name] === 'function') {\r\n    return hooks[name].apply(hooks, args)\r\n  }\r\n}\r\n\r\nexport function isEmptyObject (obj) {\r\n  for (const k in obj){\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function mapObject (obj, fn) {\r\n  const destObject = {}\r\n  for (const key in obj) {\r\n    if (obj.hasOwnProperty(key)) {\r\n      destObject[key] = fn(obj[key])\r\n    }\r\n  }\r\n  return destObject\r\n}\r\n\r\nexport function createWraper (target, before, after) {\r\n  return function (...args) {\r\n    let result\r\n\r\n    if (typeof before === 'function') {\r\n      before.apply(this, args)\r\n    }\r\n\r\n    if (typeof target === 'function') {\r\n      result = target.apply(this, args)\r\n    }\r\n\r\n    if (typeof after === 'function') {\r\n      after.apply(this, args)\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\nexport function isPlainObject (obj) {\r\n  if (typeof obj !== 'object' || obj === null) return false\r\n\r\n  const proto = Object.getPrototypeOf(obj)\r\n  if (proto === null) return true\r\n\r\n  let baseProto = proto\r\n  while (Object.getPrototypeOf(baseProto) !== null) {\r\n    baseProto = Object.getPrototypeOf(baseProto)\r\n  }\r\n  return proto === baseProto\r\n}\r\n\r\nexport function clone (value, record = new WeakMap) {\r\n  if (\r\n    value === null ||\r\n    value === undefined ||\r\n    isPrimitive(value) ||\r\n    typeof value === 'function' ||\r\n    value instanceof Date\r\n  ) {\r\n    return value\r\n  }\r\n\r\n  if (record.has(value)) return record.get(value)\r\n\r\n  const result = typeof value.constructor !== 'function'\r\n    ? Object.create(null) \r\n    : new value.constructor()\r\n\r\n  record.set(value, result)\r\n\r\n  for (const key in value) {\r\n    result[key] = clone(value[key], record)\r\n  }\r\n\r\n  return result\r\n}\r\n\r\n// parse simple path\r\nexport function parsePath (path) {\r\n  const segments = path.split('.')\r\n  return function (obj) {\r\n    for (let i = 0, len = segments.length; i < len; i++) {\r\n      if (!obj) return\r\n      obj = obj[segments[i]]\r\n    }\r\n    return obj\r\n  }\r\n}","import { assert } from './utils'\r\n\r\nexport default function (inject) {\r\n  const expandMethods = Object.create(null)\r\n\r\n  if (typeof inject === 'function') {\r\n    const callback = (name, fn) => {\r\n      assert(\r\n        typeof name === 'string',\r\n        `The mixed method name must a string.`,\r\n      )\r\n\r\n      assert(\r\n        typeof fn === 'function',\r\n        'The mixed method is not a function.'\r\n      )\r\n\r\n      assert(\r\n        !(name in expandMethods),\r\n        `The \"${name}\" is exist,`, +\r\n          `Please don't repeat mixin.`\r\n      )\r\n\r\n      expandMethods[name] = fn\r\n    }\r\n\r\n    inject(callback)\r\n  }\r\n  return expandMethods\r\n}","import { assert, parsePath, isPlainObject } from './utils'\r\n\r\n// 1. can't delete module, if module is created\r\n// 2. modules allow nesting\r\n\r\nexport const MODULE_FLAG = '__mpModule'\r\n\r\nexport function isModule (m) {\r\n  return isPlainObject(m) && m[MODULE_FLAG] === true\r\n}\r\n\r\nexport function getModule (state, namespace) {\r\n  return namespace\r\n    ? parsePath(namespace)(state)\r\n    : state\r\n}\r\n\r\nexport function mergeModule (module, partialModule, createMsg) {\r\n  const keys = Object.keys(partialModule)\r\n  let len = keys.length\r\n\r\n  while(~--len) {\r\n    const key = keys[len]\r\n\r\n    // inspect all attribute\r\n    if (createMsg) {\r\n      assert(!(key in module), createMsg)\r\n    } else {\r\n      assert(\r\n        !(isModule(module[key]) && !isModule(partialModule[key])),\r\n        `The [${key}] is a module that you can change to other values.`,\r\n      )\r\n    }\r\n  }\r\n  return Object.assign({}, module, partialModule)\r\n}\r\n\r\nexport function createModule (obj) {\r\n  assert(\r\n    isPlainObject(obj),\r\n    'The base module object must be an plain object',\r\n  )\r\n\r\n  if (isModule(obj)) return obj\r\n\r\n  assert(\r\n    !(MODULE_FLAG in obj),\r\n    `the [${MODULE_FLAG}] is the keyword of the mpStore module, you can't use it`,\r\n  )\r\n\r\n  obj[MODULE_FLAG] = true\r\n  return obj\r\n}\r\n\r\n// 1. if want to define a module, the parent and child modules must be modules.\r\n// demo:\r\n//   store.add('action', {\r\n//     __mpModule: true,\r\n//      childModule: {\r\n//       __mpModule: true,\r\n//     }\r\n//   })\r\n// \r\n// 2. if create new module, we need jugement the namespace whether in parent module\r\nexport function createModuleByNamespace (namespace, partialModule, rootModule, action) {\r\n  if (!namespace) {\r\n    return mergeModule(rootModule, partialModule)\r\n  }\r\n\r\n  let parentWraper = {}\r\n  let parentModule = rootModule\r\n  const moduleWraper = parentWraper\r\n  const segments = namespace.split('.')\r\n  const remaingMsg =  action ? `\\n\\n  --- from [${action}] action` : ''\r\n\r\n  for (let i = 0, len = segments.length; i < len; i++) {\r\n    const key = segments[i]\r\n\r\n    // the global state certainly module\r\n    if (i > 0) {\r\n      assert(\r\n        isModule(parentModule),\r\n        'the child modules must be in the parent module.\\n\\n' +\r\n          ` parent module namespace is [${key}]\\n\\n` +\r\n            ` child module namespace is [${segments[i - 1]}]${remaingMsg}`, \r\n      )\r\n    }\r\n\r\n    if (key in parentModule) {\r\n      assert(\r\n        isModule(parentModule[key]),\r\n        'you can\\'t create child moudle, ' +\r\n          `because the [${key}] already exists in [${segments[i - 1] || 'root'}] module, ` +\r\n            `but [${key}] not a module.${remaingMsg}`,\r\n      )\r\n\r\n      // the parentModule is module\r\n      const childModule = i === len - 1\r\n        ? mergeModule(parentModule[key], partialModule)\r\n        : parentModule[key]\r\n      \r\n      parentWraper[key] = childModule\r\n      parentWraper = childModule\r\n    } else {\r\n      const childModule = i === len - 1\r\n        ? createModule(partialModule)\r\n        : { __mpModule: true }\r\n\r\n      parentWraper[key] = childModule\r\n      parentWraper = childModule\r\n    }\r\n\r\n    parentModule = parentModule[key]\r\n  }\r\n  return moduleWraper\r\n}\r\n\r\n\r\n// const state = {\r\n//   a: 1,\r\n//   b: createModule({\r\n//     ba: 1,\r\n//     c: createModule({\r\n//       name: 'tao'\r\n//     }),\r\n//     d: createModule({\r\n//       dm: createModule({\r\n//         ab: 'code',\r\n//         arr: [121],\r\n//         child: {\r\n//           name: 'chen',\r\n//           __mpModule: true,\r\n//         }\r\n//       })\r\n//     })\r\n//   })\r\n// }\r\n\r\n// const namespace = ''\r\n// const module = getModule(state, namespace)\r\n// const newPModule = createModuleByNamespace(namespace, {\r\n//   aaa: 121,\r\n//   dm: {\r\n//     __mpModule: true\r\n//   }\r\n// }, state, 'test')\r\n// console.log(module)\r\n// console.log(newPModule)","export const ADD = 1\r\nexport const REMOVE = 2\r\nexport const REPLACE = 3\r\n\r\nfunction Patch (type, path, value, leftValue) {\r\n  this.type = type\r\n  this.path = path\r\n  this.value = value\r\n  this.leftValue = leftValue\r\n}\r\n\r\n// compare left and right values\r\nfunction diffValues (left, right, path, patchs) {\r\n  // filter functin and null\r\n  if (typeof left === 'function' || left === null) {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  } else if (Array.isArray(left)) {\r\n    // diff array\r\n    if (Array.isArray(right)) {\r\n      walkArray(left, right, path, patchs)\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else if (typeof left === 'object') {\r\n    // diff object\r\n    if (\r\n        right !== null &&\r\n        typeof right === 'object' &&\r\n        !Array.isArray(right)\r\n    ) {\r\n      // filter Date object\r\n      if (left instanceof Date || right instanceof Date) {\r\n        patchs.push(new Patch(REPLACE, path, right, left))\r\n      } else {\r\n        walkObject(left, right, path, patchs)\r\n      }\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  }\r\n}\r\n\r\n// if array is `[1, 2, 3, a: dd]`, filter `a`\r\nfunction walkArray (a, b, base, patchs) {\r\n  if (a.length <= b.length) {\r\n    let len = a.length\r\n    while (~--len) {\r\n      if (a[len] !== b[len]) {\r\n        const path = `${base}[${len}]`\r\n        diffValues(a[len], b[len], path, patchs)\r\n      }\r\n    }\r\n  \r\n    if (b.length > a.length) {\r\n      len = b.length\r\n      while (--len >= a.length) {\r\n        const path = `${base}[${len}]`\r\n        patchs.push(new Patch(ADD, path, b[len], a[len]))\r\n      }\r\n    }\r\n  } else {\r\n    // if new list less than old list,\r\n    // no need diff, direct replace is fine.\r\n    patchs.push(new Patch(REPLACE, base, b, a))\r\n  }\r\n}\r\n\r\nfunction walkObject (a, b, base, patchs) {\r\n  // walk left object\r\n  for (const key in a) {\r\n    // current path\r\n    const path = `${base}.${key}`\r\n\r\n    if (!(key in b)) {\r\n      patchs.push(new Patch(REMOVE, path, null, a[key]))\r\n    } else if (a[key] !== b[key]) {\r\n      diffValues(a[key], b[key], path, patchs)\r\n\r\n      // don't use `delete` statement,\r\n      // will destroy the stability of the `object` structure\r\n      // delete b[key]\r\n    }\r\n  }\r\n\r\n  // walk right object\r\n  for (const key in b) {\r\n    if (!(key in a)) {\r\n      const path = `${base}.${key}`\r\n      patchs.push(new Patch(ADD, path, b[key], null))\r\n    }\r\n  }\r\n}\r\n\r\n// root `a` and root `b` is an object\r\nexport function diff (a, b, basePath) {\r\n  const patchs = []\r\n  walkObject(a, b, basePath, patchs)\r\n  return patchs\r\n}\r\n\r\nconst REG = /[^\\[\\].]+(?=[\\[\\].])/g\r\n\r\n// return target object\r\nfunction separatePath (obj, path) {\r\n  const keys = path.match(REG)\r\n\r\n  // delete first key\r\n  if (keys && keys.shift() && keys.length > 0) {\r\n    let i = -1\r\n    let key = null\r\n    let target = obj\r\n    let prevTarget = null\r\n\r\n    while (i++ < keys.length - 2) {\r\n      prevTarget = target\r\n      key = keys[i]\r\n      target = target[key]\r\n    }\r\n\r\n    return [target, key, prevTarget, keys[keys.length -1]]\r\n  }\r\n}\r\n\r\nexport function restore (obj, patchs) {\r\n  let len = patchs.length\r\n  const deleteEmptys = new Map()\r\n\r\n  while (~--len) {\r\n    const { type, path, leftValue } = patchs[len]\r\n    // use es5 reg\r\n    const parseItem = separatePath(obj, path + '.')\r\n\r\n    if (parseItem) {\r\n      const [target, key, prevTarget, lastKey] = parseItem\r\n\r\n      // reverse recovery\r\n      switch (type) {\r\n        case REMOVE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case REPLACE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case ADD :\r\n          if (Array.isArray(target) && target === prevTarget[key]) {\r\n            deleteEmptys.set(target, { key, prevTarget })\r\n          }\r\n          delete target[lastKey]\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  deleteEmptys.forEach(({ key, prevTarget }, target) => {\r\n    const clone = new target.constructor()\r\n    // filter empty item\r\n    target.forEach(item => clone.push(item))\r\n    prevTarget[key] = clone\r\n  })\r\n\r\n  return obj\r\n}","import { diff } from './diff'\r\nimport { callHook } from './utils'\r\n\r\nexport function applyPatchs (component, patchs, callback) {\r\n  const destObject = {}\r\n\r\n  for (let i = 0, len = patchs.length; i < len; i++) {\r\n    const { value, path } = patchs[i]\r\n    destObject[path] = value\r\n  }\r\n\r\n  component.setData(destObject, callback)\r\n}\r\n\r\n// update page and component\r\nexport function updateComponents (store, callback) {\r\n  let total = 0\r\n  const {\r\n    hooks,\r\n    GLOBALWORD,\r\n    depComponents,\r\n  } = store\r\n  const len = depComponents.length\r\n\r\n  if (len === 0) {\r\n    if (typeof callback === 'function') {\r\n      callback()\r\n    }\r\n    return\r\n  }\r\n\r\n  // call `callback`, when all component views are rendered\r\n  const renderedCallback = () => {\r\n    if (++total === len) {\r\n      if (typeof callback === 'function') {\r\n        callback()\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    const {\r\n      isPage,\r\n      component,\r\n      didUpdate,\r\n      willUpdate,\r\n      createState,\r\n    } = depComponents[i]\r\n\r\n    if (component.data[GLOBALWORD]) {\r\n      const newPartialState = createState()\r\n\r\n      // the `willUpdate` function will optimize component\r\n      if (typeof willUpdate === 'function') {\r\n        if (willUpdate.call(store, component, newPartialState) === false) {\r\n          renderedCallback()\r\n          continue\r\n        }\r\n      }\r\n\r\n      // the base path is `GLOBALWORD`\r\n      // example: this.setData({ 'global.xx': xx })\r\n      const patchs = diff(component.data[GLOBALWORD], newPartialState, GLOBALWORD)\r\n\r\n      if (patchs.length > 0) {\r\n        // call global hooks\r\n        const params = [component, newPartialState, patchs, isPage]\r\n        if (callHook(hooks, 'willUpdate', params) === false) {\r\n          renderedCallback()\r\n          continue\r\n        }\r\n\r\n        // update component\r\n        applyPatchs(component, patchs, renderedCallback)\r\n\r\n        if (typeof didUpdate === 'function') {\r\n          didUpdate.call(store, component, newPartialState, patchs)\r\n        }\r\n        \r\n        callHook(hooks, 'didUpdate', [component, newPartialState, isPage])\r\n\r\n        // record patchs, allow playback view\r\n        if (component.timeTravel) {\r\n          component.timeTravel.push(patchs)\r\n        }\r\n      } else {\r\n        renderedCallback()\r\n      }\r\n    } else {\r\n      renderedCallback()\r\n    }\r\n  }\r\n}","import { applyPatchs } from './update'\r\nimport { diff, restore } from './diff'\r\nimport { warning, clone, assert } from './utils'\r\n\r\nexport default class TimeTravel {\r\n  constructor (component, GLOBALWORD, limit) {\r\n    this.history = []\r\n    this.limit = limit\r\n    this.component = component\r\n    this.GLOBALWORD = GLOBALWORD\r\n    this.length = this.history.length\r\n    this.current = this.history.length\r\n    this.finallyState = component.data[GLOBALWORD]\r\n  }\r\n\r\n  // only record diff patchs\r\n  // so, can't restore to the state at initialization\r\n  push (patchs) {\r\n    const {\r\n      limit,\r\n      history,\r\n      GLOBALWORD,\r\n      history: { length },\r\n      component: { data },\r\n    } = this\r\n\r\n    if (limit > 0) {\r\n      // if exceed the limit, should to remove the extra item\r\n      const extraCount = length - limit\r\n      if (extraCount >= 0) {\r\n        this.history.splice(0, extraCount + 1)\r\n      }\r\n\r\n      this.history.push(patchs)\r\n      this.length = history.length\r\n      this.current = history.length\r\n      // need deep clone state\r\n      this.finallyState = clone(data[GLOBALWORD])\r\n    }\r\n  }\r\n\r\n  go (n) {\r\n    const {\r\n      current,\r\n      history,\r\n      component,\r\n      GLOBALWORD,\r\n      finallyState,\r\n    } = this\r\n\r\n    assert(\r\n      GLOBALWORD in component.data,\r\n      'You can\\'t use [timeTravel] because it only works for [global state]',\r\n    )\r\n\r\n    if (this.limit > 0) {\r\n      if (n !== 0) {\r\n        const range = n + current\r\n        const backtrack = Math.abs(n)\r\n\r\n        if (range < 0 || range > history.length) {\r\n          warning(`Index [${range}] is not within the allowed range.`, true)\r\n          return\r\n        }\r\n\r\n        let index = 0\r\n        // deep clone patchs and state, we need keep state is immutable\r\n        let data = clone(component.data[GLOBALWORD])\r\n\r\n        while(index++ < backtrack) {\r\n          const id = current + Math.sign(n) * index\r\n          if (id < history.length) {\r\n            const patchs = clone(history[id])\r\n            data = restore(data, patchs)\r\n          } else {\r\n            data = finallyState\r\n          }\r\n        }\r\n\r\n        const endPatchs = diff(component.data[GLOBALWORD], data, GLOBALWORD)\r\n        if (endPatchs.length > 0) {\r\n          applyPatchs(component, endPatchs)\r\n        }\r\n\r\n        this.current += n\r\n      }\r\n    }\r\n  }\r\n\r\n  forward () {\r\n    this.go(1)\r\n  }\r\n\r\n  back () {\r\n    this.go(-1)\r\n  }\r\n\r\n  toStart () {\r\n    this.go(-this.current)\r\n  }\r\n\r\n  toEnd () {\r\n    this.go(this.history.length - this.current)\r\n  }\r\n}","import { warning, assert } from './utils'\r\n\r\nexport const COMMONACTION = () => {}\r\n\r\nfunction match (layer, action) {\r\n  if (layer.action === COMMONACTION) return true\r\n  return action === layer.action\r\n}\r\n\r\nfunction handleLayer (\r\n  action,\r\n  fn,\r\n  store,\r\n  payload,\r\n  next,\r\n  restoreProcessState,\r\n) {\r\n  try {\r\n    fn.call(store, payload, next, action)\r\n    restoreProcessState()\r\n  } catch (error) {\r\n    const hooks = store.hooks\r\n    restoreProcessState()\r\n\r\n    // if the error hook exist, don't throw error\r\n    if (hooks && typeof hooks['middlewareError'] === 'function') {\r\n      hooks['middlewareError'](action, payload, error)\r\n    } else {\r\n      warning(`${error}\\n\\n   --- from middleware [${action}] action.`)\r\n    }\r\n  }\r\n}\r\n\r\n// deal with all middleware\r\nexport class Middleware {\r\n  constructor (store) {\r\n    this.stack = []\r\n    this.store = store\r\n    this.isProcessing = false\r\n  }\r\n\r\n  use (action, fn) {\r\n    assert(\r\n      !this.isProcessing,\r\n      'can\\'t allow add new middleware in the middleware processing.'\r\n    )\r\n    this.stack.push({ fn, action })\r\n  }\r\n\r\n  remove (action, fn) {\r\n    const index = this.stack.findIndex(layer => {\r\n      return layer.fn === fn && layer.action === action\r\n    })\r\n\r\n    if (index > -1) {\r\n      this.stack.splice(index, 1)\r\n    }\r\n  }\r\n\r\n  process (action, payload, finish) {\r\n    // can't allow add new middleware in the middleware processing and setter function\r\n    this.isProcessing = true\r\n    const restoreProcessState = () => {\r\n      this.isProcessing = false\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      let index = 0\r\n      const next = prevPayload => {\r\n        let layer = this.stack[index]\r\n\r\n        index++\r\n\r\n        while (layer && !match(layer, action)) {\r\n          layer = this.stack[index++]\r\n        }\r\n\r\n        if (layer) {\r\n          // put `try catch` in a separate function,\r\n          // avoid the entire function not being optimized.\r\n          handleLayer(\r\n            action,\r\n            layer.fn,\r\n            this.store,\r\n            prevPayload,\r\n            next,\r\n            restoreProcessState,\r\n          )\r\n        } else {\r\n          finish(prevPayload, restoreProcessState)\r\n        }\r\n      }\r\n\r\n      next(payload)\r\n    } else {\r\n      finish(payload, restoreProcessState)\r\n    }\r\n  }\r\n}","import {\r\n  clone,\r\n  assert,\r\n  remove,\r\n  warning,\r\n  callHook,\r\n  parsePath,\r\n  mapObject,\r\n  mergeState,\r\n  createWraper,\r\n  inspectState,\r\n  isPlainObject,\r\n  isEmptyObject,\r\n} from './utils'\r\n\r\nimport {\r\n  isModule,\r\n  getModule,\r\n  MODULE_FLAG,\r\n  createModule,\r\n  createModuleByNamespace,\r\n} from './module'\r\n\r\nimport { diff } from './diff'\r\nimport TimeTravel from './time-travel'\r\nimport { Middleware, COMMONACTION } from './middleware'\r\nimport { applyPatchs, updateComponents } from './update'\r\n\r\n// Each `store` instance has a unique id\r\nlet storeId = 0\r\n\r\nfunction filterReducer (state, action, reducer) {\r\n  const { setter, namespace, partialState } = reducer\r\n\r\n  assert(\r\n    'partialState' in reducer,\r\n    `You must defined [partialState].` + \r\n      `\\n\\n --- from [${action}] action.`,\r\n  )\r\n\r\n  assert(\r\n    isPlainObject(partialState),\r\n    `The [partialState] must be an object.` +\r\n      `\\n\\n --- from [${action}] action.`,\r\n  )\r\n\r\n  if ('namespace' in reducer) {\r\n    assert(\r\n      typeof namespace === 'string',\r\n      'The module namespace must be a string.' +\r\n        `\\n\\n --- from [${action}] action.`,\r\n    )\r\n\r\n    const module = getModule(state, namespace, action)\r\n    \r\n    if (module) {\r\n      // const newPartialModule = mergeModule(module, partialState, true)\r\n      // const \r\n    } else {\r\n\r\n    }\r\n  } else {\r\n    // inspect all state key \r\n    inspectState(partialState, state, key => {\r\n      return `The [${key}] already exists in global state, ` +\r\n        `Please don't repeat defined. \\n\\n --- from [${action}] action.`\r\n    })\r\n\r\n    // if `partialState` have `__mpModule` word, in fact, the `partialState` is module\r\n    if (isModule(partialState)) {\r\n\r\n    }\r\n  }\r\n\r\n  if (typeof setter !== 'function') {\r\n    reducer.setter = () => {\r\n      warning(\r\n        `Can\\'t changed [${action}] action value. Have you defined a setter?` +\r\n          `\\n\\n --- from [${action}] action.`\r\n      )\r\n    }\r\n  }\r\n  return reducer\r\n}\r\n\r\nexport class Store {\r\n  constructor (hooks) {\r\n    this.hooks = hooks\r\n    this.reducers = []\r\n    this.id = ++storeId\r\n    this.depComponents = []\r\n    this.GLOBALWORD = 'global' // global state namespace\r\n    this.isDispatching = false\r\n    this.version = __VERSION__\r\n    this.state = Object.freeze(createModule({}))\r\n    this.middleware = new Middleware(this)\r\n  }\r\n\r\n  add (action, reducer) {\r\n    assert(\r\n      !this.reducers.find(v => v.action === action),\r\n      `Can't repeat defined [${action}] action.`,\r\n    )\r\n\r\n    const { partialState } = filterReducer(this.state, action, reducer)\r\n\r\n    reducer.action = action\r\n    this.reducers.push(reducer)\r\n    if (!isEmptyObject(partialState)) {\r\n      this.state = mergeState(this.state, partialState)\r\n    }\r\n  }\r\n\r\n  dispatch (action, payload, callback) {\r\n    const { reducers, isDispatching } = this\r\n\r\n    // if we in call dispatch process,\r\n    // we don't allow call dispacth again.\r\n    assert(\r\n      !isDispatching,\r\n      'It is not allowed to call \"dispatch\" during dispatch execution.' +\r\n        `\\n\\n   --- from [${action}] action.`\r\n    )\r\n\r\n    const reducer = reducers.find(v => v.action === action)\r\n\r\n    assert(\r\n      reducer,\r\n      `The [${action}] action does not exist. ` +\r\n        'Maybe you have not defined.'\r\n    )\r\n\r\n    // call all middleware\r\n    this.middleware.process(action, payload, (destPayload, restoreProcessState) => {\r\n      this.isDispatching = true\r\n\r\n      try {\r\n        let newPartialState\r\n        const namespace = reducer.namespace\r\n        const isModuleDispatch = typeof namespace === 'string'\r\n\r\n        if (isModuleDispatch) {\r\n          const module = this.getModule(namespace, true)\r\n          // generate new partial state\r\n          newPartialState = reducer.setter(module, destPayload, this.state)\r\n        } else {\r\n          newPartialState = reducer.setter(this.state, destPayload)\r\n        }\r\n\r\n        assert(\r\n          isPlainObject(newPartialState),\r\n          'setter function should be return a plain object.',\r\n        )\r\n        \r\n        // update global state\r\n        if (!isEmptyObject(newPartialState)) {\r\n          if (isModuleDispatch) {\r\n            this.state = mergeState(\r\n              this.state,\r\n              {\r\n                [namespace]: Object.assign(\r\n                  {},\r\n                  this.getModule(namespace),\r\n                  newPartialState,\r\n                ),\r\n              },\r\n            )\r\n          } else {\r\n            this.state = mergeState(\r\n              this.state,\r\n              newPartialState,\r\n            )\r\n          }\r\n        }\r\n      } finally {\r\n        // the `isDispatching` need restore.\r\n         this.isDispatching = false\r\n        // restore state\r\n        restoreProcessState()\r\n      }\r\n\r\n      // update components\r\n      updateComponents(this, callback)\r\n    })\r\n  }\r\n\r\n  // add middleware\r\n  use (action, fn) {\r\n    if (\r\n      typeof action === 'function' &&\r\n      action !== COMMONACTION\r\n    ) {\r\n      fn = action\r\n      action = COMMONACTION\r\n    }\r\n\r\n    this.middleware.use(action, fn)\r\n    return () => this.middleware.remove(action, fn)\r\n  }\r\n\r\n  // allow change `GLOBALWORD`.\r\n  setNamespace (key) {\r\n    assert(\r\n      key && typeof key === 'string',\r\n      'The [namespace] must be a string',\r\n    )\r\n    this.GLOBALWORD = key\r\n  }\r\n\r\n  // get module\r\n  getModule (namespace, needInspect) {\r\n    assert(\r\n      typeof namespace === 'string',\r\n      'the namespace mast be a string',\r\n    )\r\n\r\n    // deal with module state\r\n    const module = parsePath(namespace)(this.state)\r\n    // if the module does not meet the requirements\r\n    // throw error\r\n    if (needInspect && !(isPlainObject(module) && module.__mpModule)) {\r\n      warning(`The [${namespace}] module is not exist.`)\r\n    }\r\n    \r\n    return module\r\n  }\r\n\r\n  // insert method\r\n  rewirteCfgAndAddDep (config, isPage) {\r\n    let createState = null\r\n    const store = this\r\n    const GLOBALWORD = this.GLOBALWORD\r\n    const { data, storeConfig = {} } = config\r\n    const {\r\n      useState,\r\n      didUpdate,\r\n      willUpdate,\r\n      defineReducer,\r\n      travelLimit = 0, // default not open time travel function\r\n    } = storeConfig\r\n\r\n    assert(\r\n      typeof travelLimit === 'number',\r\n      `[travelLimit] must be a number, but now is [${typeof travelLimit}].`\r\n    )\r\n\r\n    delete config.storeConfig\r\n\r\n    // this is a uitl method,\r\n    // allow craete reducer in the page or component.\r\n    if (typeof defineReducer === 'function') {\r\n      defineReducer.call(store, store)\r\n    }\r\n\r\n    // get the global state words used\r\n    if (typeof useState === 'function') {\r\n      let namespace = null\r\n      let defineObject = null\r\n      const useConfig = useState.call(store, store)\r\n\r\n      // inspect should need module state\r\n      if (Array.isArray(useConfig)) {\r\n        namespace = useConfig[0]\r\n        defineObject = useConfig[1]\r\n      } else {\r\n        defineObject = useConfig\r\n      }\r\n\r\n      assert(\r\n        isPlainObject(defineObject),\r\n        '[useState] must return a plain object, ' +\r\n          `but now is return a [${typeof defineObject}]`,\r\n      )\r\n      \r\n      // need deep clone, otherwise the `data.global` on the back of the component cannot be changed.\r\n      createState = () => clone(mapObject(defineObject, fn => {\r\n        return namespace === null\r\n          ? fn(store.state)\r\n          : fn(this.getModule(namespace, true), store.state)\r\n      }))\r\n    }\r\n\r\n    // get state used by the current component\r\n    if (createState !== null) {\r\n      const useState = createState()\r\n      if (isPlainObject(useState)) {\r\n        data \r\n          ? data[GLOBALWORD] = useState\r\n          : config.data = { [GLOBALWORD]: useState }\r\n      }\r\n    }\r\n\r\n    const addDep = component => {\r\n      const shouldAdd = callHook(this.hooks, 'addDep', [component, isPage])\r\n\r\n      // if no used global state word,\r\n      // no need to add dependencies.\r\n      if (shouldAdd !== false && createState !== null) {\r\n        if (component.data && isPlainObject(component.data[GLOBALWORD])) {\r\n          // time travel can record diff patchs\r\n          component.timeTravel = new TimeTravel(component, GLOBALWORD, travelLimit)\r\n\r\n          // add component to depComponents\r\n          this.depComponents.push({\r\n            isPage,\r\n            component,\r\n            didUpdate,\r\n            willUpdate,\r\n            createState,\r\n          })\r\n\r\n          // if the global state is changed, need update component\r\n          const patchs = diff(component.data[GLOBALWORD], createState(), GLOBALWORD)\r\n          if (patchs.length > 0) {\r\n            applyPatchs(component, patchs, GLOBALWORD)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (isPage) {\r\n      config.onLoad = createWraper(\r\n        config.onLoad,\r\n        function () {\r\n          addDep(this)\r\n          // rigister store to component within\r\n          this.store = store\r\n        },\r\n      )\r\n      \r\n      config.onUnload = createWraper(\r\n        config.onUnload,\r\n        null,\r\n        function () {\r\n          // clear cache\r\n          remove(store.depComponents, this)\r\n        },\r\n      )\r\n    } else {\r\n      // Component\r\n      config.lifetimes = config.lifetimes || {}\r\n      const get = name => config[name] || config.lifetimes[name]\r\n      const set = (name, fn) => config[name] = config.lifetimes[name] = fn\r\n\r\n      set('attached', createWraper(\r\n        get('attached'),\r\n        function () {\r\n          addDep(this)\r\n          this.store = store\r\n        },\r\n      ))\r\n\r\n      set('detached', createWraper(\r\n        get('detached'),\r\n        null,\r\n        function () {\r\n          remove(store.depComponents, this)\r\n        },\r\n      ))\r\n    }\r\n  }\r\n}","import {\r\n  callHook,\r\n  mixinMethods,\r\n  createWraper,\r\n  isEmptyObject,\r\n} from './utils'\r\nimport mixin from './mixin'\r\nimport { Store } from './store'\r\nexport { clone } from './utils'\r\nexport { diff, restore } from './diff'\r\nexport { createModule } from './module'\r\n\r\nexport const version = __VERSION__\r\n\r\nconst nativePage = Page\r\nconst nativeComponent = Component\r\n\r\nfunction expandConfig (config, expandMethods, isPage) {\r\n  if (!isEmptyObject(expandMethods)) {\r\n    if (isPage) {\r\n      mixinMethods(config, expandMethods)\r\n    } else {\r\n      config.methods = config.methods || {}\r\n      mixinMethods(config.methods, expandMethods)\r\n    }\r\n  }\r\n}\r\n\r\nexport default function (mixinInject, hooks) {\r\n  const store = new Store(hooks)\r\n  const expandMethods = mixin(mixinInject)\r\n\r\n  // we can rewirte Page and Component function\r\n  // this will be better compatible with previous project\r\n  Page = createWraper(\r\n    nativePage,\r\n    function (config) {\r\n      // we allow add additional config attributes\r\n      callHook(hooks, 'createBefore', [config, true])\r\n\r\n      expandConfig(config, expandMethods, true)\r\n    \r\n      // the store will record all page and component\r\n      // when global state changed, the dependent components will be update\r\n      store.rewirteCfgAndAddDep(config, true)\r\n    },\r\n  )\r\n\r\n  Component = createWraper(\r\n    nativeComponent,\r\n    function (config) {\r\n      callHook(hooks, 'createBefore', [config, false])\r\n\r\n      expandConfig(config, expandMethods, false)\r\n      store.rewirteCfgAndAddDep(config, false)\r\n    },\r\n  )\r\n\r\n  return store\r\n}"],"names":["warning","message","noError","console","warn","Error","assert","condition","isPrimitive","value","deepFreeze","state","names","Object","getOwnPropertyNames","len","length","freeze","mergeState","oldState","newState","assign","mixinMethods","config","methods","key","inspectState","partialState","sendWarn","hasOwnProperty","remove","list","component","index","findIndex","item","splice","callHook","hooks","name","args","apply","isEmptyObject","obj","k","mapObject","fn","destObject","createWraper","target","before","after","result","isPlainObject","proto","getPrototypeOf","baseProto","clone","record","WeakMap","undefined","Date","has","get","constructor","create","set","parsePath","path","segments","split","i","inject","expandMethods","callback","MODULE_FLAG","isModule","m","getModule","namespace","createModule","ADD","REMOVE","REPLACE","Patch","type","leftValue","diffValues","left","right","patchs","push","Array","isArray","walkArray","walkObject","a","b","base","diff","basePath","REG","separatePath","keys","match","shift","prevTarget","restore","deleteEmptys","Map","parseItem","lastKey","forEach","applyPatchs","setData","updateComponents","store","total","GLOBALWORD","depComponents","renderedCallback","isPage","didUpdate","willUpdate","createState","data","newPartialState","call","params","timeTravel","TimeTravel","limit","history","current","finallyState","extraCount","n","range","backtrack","Math","abs","id","sign","endPatchs","go","COMMONACTION","layer","action","handleLayer","payload","next","restoreProcessState","error","Middleware","stack","isProcessing","finish","prevPayload","storeId","filterReducer","reducer","setter","module","Store","reducers","isDispatching","version","__VERSION__","middleware","find","v","process","destPayload","isModuleDispatch","use","needInspect","__mpModule","storeConfig","useState","defineReducer","travelLimit","defineObject","useConfig","addDep","shouldAdd","onLoad","onUnload","lifetimes","nativePage","Page","nativeComponent","Component","expandConfig","mixinInject","mixin","rewirteCfgAndAddDep"],"mappings":"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"}